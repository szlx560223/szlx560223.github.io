<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/black/pace-theme-corner-indicator.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.14.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":true,"color":"#000","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="前言写这篇笔记的想法源于之前参加的Cocos开发实训，舍友说听课门槛对他来说有些过高了，故我打算在此以稍微通俗易懂一点的语言描述我这次的开发之旅，因此这篇教程会十分啰嗦，还请读者按需阅读。 项目地址  第一次写教程向的东西，有疏漏请见谅 部分图片泛灰是我开了夜览模式截图，对可能造成的阅读不便我表示非常抱歉 本文图片未使用图床且数量较多，请使用科学手段以获得最佳阅读体验">
<meta property="og:type" content="article">
<meta property="og:title" content="游戏开发笔记#2——2022暑假自制Flappy Bird">
<meta property="og:url" content="http://example.com/2022/07/14/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2%E2%80%94%E2%80%942022%E6%9A%91%E5%81%87%E8%87%AA%E5%88%B6Flappy-Bird/index.html">
<meta property="og:site_name" content="FireEgg&#39;s Blog">
<meta property="og:description" content="前言写这篇笔记的想法源于之前参加的Cocos开发实训，舍友说听课门槛对他来说有些过高了，故我打算在此以稍微通俗易懂一点的语言描述我这次的开发之旅，因此这篇教程会十分啰嗦，还请读者按需阅读。 项目地址  第一次写教程向的东西，有疏漏请见谅 部分图片泛灰是我开了夜览模式截图，对可能造成的阅读不便我表示非常抱歉 本文图片未使用图床且数量较多，请使用科学手段以获得最佳阅读体验">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716231202427.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716231813177.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716232643396.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716232040423.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716234149823.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716234321613.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716235009285.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717141347934.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717143148200.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717143447178.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717144017558.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717144316422.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717144520411.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717144809306.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717144946605.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717145333428.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220803193719921.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717175117142.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717175802120.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717181704104.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717191028023.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717192303927.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717192823440.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717193046643.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717193504004.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717194829425.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-1.gif">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220722221006045.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220722235134220.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220723171309655.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220723172359859.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220723174317723.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-2.gif">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-3.gif">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-4.gif">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220724000315146.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220724225149224.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220725000219869.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220725123723916.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220726203910465.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-5.gif">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-6.gif">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220731112337393.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-7.gif">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220801174731726.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220801183856343.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-8.gif">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220804175548524.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220804180326426.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220809215703258.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220809215730843.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220809224942404.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220810130524644.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220810130654129.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220820102237378.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220820203522340.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-9.gif">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220820221219663.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220820223726317.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220820223939129.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220820235004862.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-10.gif">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821104444120.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821110658300.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821111927776.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821113148384.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821113418768.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821111139529.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821111242418.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821111305450.png">
<meta property="og:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821111325713.png">
<meta property="article:published_time" content="2022-07-14T15:32:39.000Z">
<meta property="article:modified_time" content="2023-01-01T14:39:34.265Z">
<meta property="article:author" content="Fire Egg">
<meta property="article:tag" content="Cocos">
<meta property="article:tag" content="游戏开发">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716231202427.png">


<link rel="canonical" href="http://example.com/2022/07/14/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2%E2%80%94%E2%80%942022%E6%9A%91%E5%81%87%E8%87%AA%E5%88%B6Flappy-Bird/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2022/07/14/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2%E2%80%94%E2%80%942022%E6%9A%91%E5%81%87%E8%87%AA%E5%88%B6Flappy-Bird/","path":"2022/07/14/游戏开发笔记-2——2022暑假自制Flappy-Bird/","title":"游戏开发笔记#2——2022暑假自制Flappy Bird"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>游戏开发笔记#2——2022暑假自制Flappy Bird | FireEgg's Blog</title>
  






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">FireEgg's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87"><span class="nav-number">2.</span> <span class="nav-text">前期准备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E5%BF%85%E8%A6%81%E8%BD%AF%E4%BB%B6"><span class="nav-number">2.1.</span> <span class="nav-text">下载必要软件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#VSCode"><span class="nav-number">2.1.1.</span> <span class="nav-text">VSCode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cocos-Dashboard-amp-Cocos-Creator"><span class="nav-number">2.1.2.</span> <span class="nav-text">Cocos Dashboard &amp; Cocos Creator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA%E5%A5%BD%E7%94%A8%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="nav-number">2.1.3.</span> <span class="nav-text">一个好用的浏览器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AF%E4%BB%B6%E5%86%85%E8%B0%83%E6%95%B4"><span class="nav-number">2.2.</span> <span class="nav-text">软件内调整</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Cocos"><span class="nav-number">2.2.1.</span> <span class="nav-text">Cocos</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#VSCode-1"><span class="nav-number">2.2.2.</span> <span class="nav-text">VSCode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8-%E4%BB%A5Edge%E4%B8%BA%E4%BE%8B"><span class="nav-number">2.2.3.</span> <span class="nav-text">浏览器(以Edge为例)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B5%84%E6%96%99%E5%8F%82%E8%80%83"><span class="nav-number">3.</span> <span class="nav-text">资料参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TypeScript%E8%AF%AD%E6%B3%95%E6%95%99%E7%A8%8B"><span class="nav-number">3.1.</span> <span class="nav-text">TypeScript语法教程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cocos-Creator-%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C"><span class="nav-number">3.2.</span> <span class="nav-text">Cocos Creator 用户手册</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cocos-Creator-API%E6%96%87%E6%A1%A3"><span class="nav-number">3.3.</span> <span class="nav-text">Cocos Creator API文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%99%BD%E7%8E%89%E6%97%A0%E5%86%B0%E8%80%81%E5%B8%88%E7%9A%84%E8%B7%B3%E4%B8%80%E8%B7%B3%E6%95%99%E7%A8%8B"><span class="nav-number">3.4.</span> <span class="nav-text">白玉无冰老师的跳一跳教程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E9%80%BB%E8%BE%91%E6%A2%B3%E7%90%86"><span class="nav-number">4.</span> <span class="nav-text">游戏逻辑梳理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B2%E4%B8%8B%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81"><span class="nav-number">5.</span> <span class="nav-text">敲下你的第一行代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF%E5%88%87%E6%8D%A2"><span class="nav-number">5.1.</span> <span class="nav-text">场景切换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E5%85%83%E7%B4%A0"><span class="nav-number">5.2.</span> <span class="nav-text">游戏元素</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A1%E5%88%86%E6%9D%BF"><span class="nav-number">5.2.1.</span> <span class="nav-text">计分板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%92%E8%89%B2"><span class="nav-number">5.2.2.</span> <span class="nav-text">角色</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E7%89%A9%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="nav-number">5.2.2.1.</span> <span class="nav-text">开启物理系统</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E8%BE%93%E5%85%A5%E7%9B%91%E5%90%AC"><span class="nav-number">5.2.2.2.</span> <span class="nav-text">开启输入监听</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B0%83%E6%95%B4%E7%89%A9%E7%90%86%E4%B8%96%E7%95%8C%E5%8F%82%E6%95%B0"><span class="nav-number">5.2.2.3.</span> <span class="nav-text">调整物理世界参数</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%9C%E7%A2%8D%E7%89%A9"><span class="nav-number">5.2.3.</span> <span class="nav-text">障碍物</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%9F%E6%88%90"><span class="nav-number">5.2.3.1.</span> <span class="nav-text">生成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8"><span class="nav-number">5.2.3.2.</span> <span class="nav-text">移动</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A2%B0%E6%92%9E%E6%A3%80%E6%B5%8B"><span class="nav-number">5.2.3.3.</span> <span class="nav-text">碰撞检测</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E6%9C%BA%E5%88%B6"><span class="nav-number">5.3.</span> <span class="nav-text">游戏机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="nav-number">5.3.1.</span> <span class="nav-text">状态机</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BE%97%E5%88%86%E5%88%A4%E5%AE%9A"><span class="nav-number">5.3.2.</span> <span class="nav-text">得分判定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="nav-number">5.3.3.</span> <span class="nav-text">流程控制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E6%9A%82%E5%81%9C%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="nav-number">5.3.3.1.</span> <span class="nav-text">游戏暂停与恢复</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AD%BB%E4%BA%A1%E7%BB%93%E7%AE%97"><span class="nav-number">5.3.3.2.</span> <span class="nav-text">死亡结算</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">5.3.3.3.</span> <span class="nav-text">游戏初始化</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%98%B6%E6%AE%B5%E6%80%A7%E7%BB%93%E5%B0%BE"><span class="nav-number">6.</span> <span class="nav-text">阶段性结尾</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E9%98%B6%E5%86%85%E5%AE%B9"><span class="nav-number">7.</span> <span class="nav-text">进阶内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96"><span class="nav-number">7.1.</span> <span class="nav-text">代码优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8"><span class="nav-number">7.1.1.</span> <span class="nav-text">解决循环引用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%91%E5%AE%9A%E5%8D%95%E4%BE%8B"><span class="nav-number">7.1.2.</span> <span class="nav-text">绑定单例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E6%95%B4%E5%88%86%E8%BE%A8%E7%8E%87"><span class="nav-number">7.2.</span> <span class="nav-text">调整分辨率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E5%8F%98%E9%87%8F%E5%88%86%E7%A6%BB"><span class="nav-number">7.3.</span> <span class="nav-text">游戏变量分离</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E5%86%85%E5%AE%B9%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="nav-number">7.4.</span> <span class="nav-text">游戏内容自定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E5%9C%BA%E6%99%AF%E7%BE%8E%E5%8C%96"><span class="nav-number">7.5.</span> <span class="nav-text">游戏场景美化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%8C%E6%99%AF"><span class="nav-number">7.5.1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%9C%E7%A2%8D%E7%89%A9-1"><span class="nav-number">7.5.2.</span> <span class="nav-text">障碍物</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%B8%9F%E5%84%BF"><span class="nav-number">7.5.3.</span> <span class="nav-text">鸟儿</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A1%E5%88%86%E6%9D%BF-1"><span class="nav-number">7.5.4.</span> <span class="nav-text">计分板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%95%8C%E9%9D%A2"><span class="nav-number">7.5.5.</span> <span class="nav-text">界面</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%9B%E5%85%89%E6%89%93%E7%A3%A8"><span class="nav-number">7.6.</span> <span class="nav-text">抛光打磨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#GameManager"><span class="nav-number">7.6.1.</span> <span class="nav-text">GameManager</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BirdCtrl"><span class="nav-number">7.6.2.</span> <span class="nav-text">BirdCtrl</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MenuManager"><span class="nav-number">7.6.3.</span> <span class="nav-text">MenuManager</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Setting"><span class="nav-number">7.6.4.</span> <span class="nav-text">Setting</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SettingManager"><span class="nav-number">7.6.5.</span> <span class="nav-text">SettingManager</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%98%E5%8F%AF%E4%BB%A5%E5%81%9A%E7%9A%84%E4%BA%8B%E6%83%85"><span class="nav-number">7.7.</span> <span class="nav-text">还可以做的事情</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Fire Egg"
      src="/images/avatar.JPG">
  <p class="site-author-name" itemprop="name">Fire Egg</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/szlx560223" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;szlx560223" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/6538879" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;6538879" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>Bilibili</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/14/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2%E2%80%94%E2%80%942022%E6%9A%91%E5%81%87%E8%87%AA%E5%88%B6Flappy-Bird/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.JPG">
      <meta itemprop="name" content="Fire Egg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FireEgg's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="游戏开发笔记#2——2022暑假自制Flappy Bird | FireEgg's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          游戏开发笔记#2——2022暑假自制Flappy Bird
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-14 23:32:39" itemprop="dateCreated datePublished" datetime="2022-07-14T23:32:39+08:00">2022-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-01 22:39:34" itemprop="dateModified" datetime="2023-01-01T22:39:34+08:00">2023-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>89k</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>写这篇笔记的想法源于之前参加的Cocos开发实训，舍友说听课门槛对他来说有些过高了，故我打算在此以稍微通俗易懂一点的语言描述我这次的开发之旅，因此这篇教程会十分啰嗦，还请读者按需阅读。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/szlx560223/Flappy_Bird">项目地址</a></p>
<ul>
<li>第一次写教程向的东西，有疏漏请见谅</li>
<li>部分图片泛灰是我开了夜览模式截图，对可能造成的阅读不便我表示非常抱歉</li>
<li>本文图片未使用图床且数量较多，请使用科学手段以获得最佳阅读体验</li>
</ul>
<span id="more"></span>

<h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><h3 id="下载必要软件"><a href="#下载必要软件" class="headerlink" title="下载必要软件"></a>下载必要软件</h3><h4 id="VSCode"><a href="#VSCode" class="headerlink" title="VSCode"></a>VSCode</h4><p><a target="_blank" rel="noopener" href="https://code.visualstudio.com/">点此直达</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://code.visualstudio.com/</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716231202427.png" alt="VSCode"></p>
<ul>
<li>用来敲代码，界面也很不错</li>
</ul>
<h4 id="Cocos-Dashboard-amp-Cocos-Creator"><a href="#Cocos-Dashboard-amp-Cocos-Creator" class="headerlink" title="Cocos Dashboard &amp; Cocos Creator"></a>Cocos Dashboard &amp; Cocos Creator</h4><p><a target="_blank" rel="noopener" href="https://www.cocos.com/creator">点此直达</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cocos.com/creator</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716231813177.png" alt="Cocos Creator"></p>
<ul>
<li>Cocos游戏引擎的管理面板，用于管理编辑器的版本与项目存储</li>
</ul>
<h4 id="一个好用的浏览器"><a href="#一个好用的浏览器" class="headerlink" title="一个好用的浏览器"></a>一个好用的浏览器</h4><ul>
<li>Edge,Chrome,Firefox,360之类的，有F12呼出控制台的都可以，这里放个Chrome的网址</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.google.cn/chrome/">点此直达</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.google.cn/chrome/</span><br></pre></td></tr></table></figure>

<h3 id="软件内调整"><a href="#软件内调整" class="headerlink" title="软件内调整"></a>软件内调整</h3><h4 id="Cocos"><a href="#Cocos" class="headerlink" title="Cocos"></a>Cocos</h4><p>打开Cocos Dashboard，初次登录需要使用手机号注册账号。登陆完成后</p>
<ol>
<li>点击界面右上角的齿轮</li>
<li>Language栏切换语言</li>
<li>在Editor Folder(编辑器目录)选择引擎存放的位置(保持默认也行)</li>
</ol>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716232643396.png" alt="Cocos Dashboard设置界面"></p>
<p>之后在<strong>编辑器</strong>界面选择版本号最大的下载安装就行(本教程为3.5.2，截稿时已更新3.6.0)</p>
<p>下载完成后界面与图中的一致就算成功了</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716232040423.png" alt="下载编辑器"></p>
<p>之后依次点击项目，新建项目</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716234149823.png" alt="新建项目1"></p>
<ol>
<li>选择Empty(3D) (空项目)</li>
<li>更改项目名称</li>
<li>选择项目储存位置</li>
<li>点击创建<br> <img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716234321613.png" alt="新建项目2"></li>
</ol>
<ul>
<li>编辑器版本应该会自动选择，如果没有说明编辑器没下完\有问题，返回上一步重试</li>
</ul>
<p>进到这个界面就算成功</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220716235009285.png" alt="编辑器主界面"></p>
<ul>
<li>有部分人会在底部的控制台出现红字，原因多半是运行库缺失。出现这种情况可以直接点击红字里的网址下载运行库(如果有的话)，其他红字<strong>请善用翻译软件</strong></li>
</ul>
<p>之后点击左上角的Cocos Creator，选择Preferences，在language栏选择<strong>中文</strong>就可以将编辑器改成中文的了</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717141347934.png" alt="编辑器-偏好设置1"></p>
<p>接着在<strong>外部程序</strong>栏将默认脚本编辑器那一栏填入你VSCode安装的位置就可以了(选择桌面上的快捷方式就行)</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717143148200.png" alt="编辑器-偏好设置2"></p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717143447178.png" alt="编辑器-偏好设置3"></p>
<p><strong>至此你的游戏引擎就准备好啦</strong></p>
<h4 id="VSCode-1"><a href="#VSCode-1" class="headerlink" title="VSCode"></a>VSCode</h4><p>打开VSCode</p>
<p>点击左侧<strong>扩展</strong>按钮</p>
<p>安装如图所示的三个插件</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717144017558.png" alt="VSCode插件"></p>
<table>
<thead>
<tr>
<th>插件名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>Chinese(Simplified)</td>
<td>中文语言包，可以将编辑器语言设置为中文</td>
</tr>
<tr>
<td>Cocos Creator JS</td>
<td>可以在你编写Cocos的脚本代码时提供提示与代码补全（目前引擎已经自带）</td>
</tr>
<tr>
<td>JavaScript and TypeScript Nightly</td>
<td>为TypeScript提供更好的支持</td>
</tr>
</tbody></table>
<h4 id="浏览器-以Edge为例"><a href="#浏览器-以Edge为例" class="headerlink" title="浏览器(以Edge为例)"></a>浏览器(以Edge为例)</h4><p>按键盘上的F12，选择<strong>打开开发工具</strong></p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717144316422.png" alt="打开浏览器开发工具1"></p>
<p>能看到这个页面就算成功(其他浏览器同理)</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717144520411.png" alt="打开浏览器开发工具2"></p>
<h2 id="资料参考"><a href="#资料参考" class="headerlink" title="资料参考"></a>资料参考</h2><h3 id="TypeScript语法教程"><a href="#TypeScript语法教程" class="headerlink" title="TypeScript语法教程"></a>TypeScript语法教程</h3><p><a target="_blank" rel="noopener" href="https://www.runoob.com/typescript/ts-tutorial.html">点此直达</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.runoob.com/typescript/ts-tutorial.html</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717144809306.png" alt="菜鸟教程"></p>
<ul>
<li>由于篇幅限制，本教程不提供TypeScript语法基础教学，还请读者自行学习</li>
</ul>
<h3 id="Cocos-Creator-用户手册"><a href="#Cocos-Creator-用户手册" class="headerlink" title="Cocos Creator 用户手册"></a>Cocos Creator 用户手册</h3><p><a target="_blank" rel="noopener" href="https://docs.cocos.com/creator/manual/zh/">点此直达</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.cocos.com/creator/manual/zh/</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717144946605.png" alt="Cocos Creator 用户手册"></p>
<ul>
<li>这里包含引擎组件的基本用法(内含跳一跳等demo教程)，读完后相信你能对Cocos游戏引擎有一定的了解</li>
</ul>
<h3 id="Cocos-Creator-API文档"><a href="#Cocos-Creator-API文档" class="headerlink" title="Cocos Creator API文档"></a>Cocos Creator API文档</h3><p><a target="_blank" rel="noopener" href="https://docs.cocos.com/creator/api/zh/">点此直达</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.cocos.com/creator/api/zh/</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717145333428.png" alt="Cocos Creator API文档"></p>
<ul>
<li>Cocos引擎所有组件的所有用法，无微不至，阅读门槛较高，若有进一步开发需求务必阅读</li>
</ul>
<h3 id="白玉无冰老师的跳一跳教程"><a href="#白玉无冰老师的跳一跳教程" class="headerlink" title="白玉无冰老师的跳一跳教程"></a>白玉无冰老师的跳一跳教程</h3><p><a target="_blank" rel="noopener" href="https://zfxdvouj61.feishu.cn/docx/doxcnG4QlYVj73PmnId8uEdGVzd">点此直达</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://zfxdvouj61.feishu.cn/docx/doxcnG4QlYVj73PmnId8uEdGVzd</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220803193719921.png" alt="白玉无冰老师的跳一跳教程"></p>
<ul>
<li>本教程行文结构的参考方向，同时也是个很好上手的demo教程，在这里非常感谢老师能来学校给我们上课！</li>
</ul>
<p><strong>至此，所有前期准备完成，你将开始正式的游戏制作</strong></p>
<h2 id="游戏逻辑梳理"><a href="#游戏逻辑梳理" class="headerlink" title="游戏逻辑梳理"></a>游戏逻辑梳理</h2><p>首先，在你的脑海里回忆一下，你玩过的小游戏的逻辑是怎么样的</p>
<p>一般来说，应该是这样的：</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717175117142.png" alt="游戏逻辑"></p>
<p>这里涉及到两个<strong>场景</strong></p>
<ol>
<li>主界面的场景</li>
<li>游玩时的场景</li>
</ol>
<p>因此，我们需要两个场景来支撑这个游戏。右键左边资源管理器中的asset，新建一个文件夹，然后再在文件夹里新建两个场景，分别命名为main和game(名称和文件夹名字自己可以随便取，不过<strong>资源管理</strong>也是游戏开发的重要一环，所以尽量整得通俗易懂一些)</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717175802120.png" alt="新建场景"></p>
<div id="2"></div>

<p>接着，我们把流程图里的<strong>游玩</strong>部分细化一下</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717181704104.png" alt="细化的游戏逻辑"></p>
<p>驱动这样一个流程需要<strong>脚本</strong>的支持，所以我们需要新建一个脚本文件。同上，我们最好新建一个script文件夹，再在里面新建一个脚本文件，选择NewComponent，并命名为GameManager。同理，为了实现两个场景的切换，我们新建需要另外一个脚本，命名为GameSceneChange</p>
<h2 id="敲下你的第一行代码"><a href="#敲下你的第一行代码" class="headerlink" title="敲下你的第一行代码"></a>敲下你的第一行代码</h2><h3 id="场景切换"><a href="#场景切换" class="headerlink" title="场景切换"></a>场景切换</h3><p>双击刚才新建的GameSceneChange脚本文件，如果你之前按步骤绑定了VSCode的话，应该会直接用VSCode打开</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717191028023.png" alt="初始的脚本"></p>
<p>新建的脚本有一些初始内容，具体作用如图所示，update和start函数这里用不上，这里可以注释掉或者删掉</p>
<p>然后我们可以在class里（下称类内）写下第一个函数(函数名随意)</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">changeScene</span>(<span class="params">SceneName</span>)&#123;</span><br><span class="line">    director.<span class="title function_">loadScene</span>(<span class="title class_">SceneName</span>);<span class="comment">//加载场景</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>director.loadScene(SceneName)方法是加载场景的api，参数内容是场景的名字，他可以用来帮助我们加载另一个场景以实现场景切换</p>
</blockquote>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717192303927.png" alt="出现报错"></p>
<p>如果你是直接复制这段函数的话，大概率会爆红，解决方法是在最上方的import里加入<strong>director</strong>组件(或者鼠标移到出现问题的地方之后选择快速修复，如图所示)</p>
<p>然后<strong>保存文件</strong></p>
<p>既然我们写好了一段函数，那我们要怎么触发呢？按常理来讲，切换场景意味着游戏开始，所以这个函数应该在玩家点击<strong>开始游戏</strong>后触发，所以一个<strong>按钮</strong>是最好的选择</p>
<p>回到编辑器内。在左上角的层级管理器里新建一个按钮，名称随意。之后会出来一大堆东西，这个后面再讲</p>
<div id="1"></div>

<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717192823440.png" alt="新建一个按钮"></p>
<p>点击层级管理器里的按钮，右边有一大堆东西，最下面有个Click Events，代表按钮点击后执行的操作数，把数值改为1</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717193046643.png" alt="修改Click Events"></p>
<p>之后将<strong>资源管理器</strong>里的GameSceneChange脚本文件拖到<strong>层级管理器</strong>里，再把<strong>层级管理器</strong>里的GameSceneChange<strong>节点</strong>拖到按钮里Click Events的节点里。之后在附属选项里选择子类名字(只有一个)，和函数名(changeScene)，参数填游戏场景的名字，这里是game。<strong>这个参数将作为名叫CustomEventData的形参传入你的函数</strong></p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717193504004.png" alt="拖动脚本"></p>
<p>除此之外，因为是按钮触发，所以还需要一个Event事件作为函数的形参。因此，你需要稍微修改你的函数，最终代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameSceneChange.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, director &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameSceneChange&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameSceneChange</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">changeScene</span>(<span class="params">event:Event,CustomEventData</span>)&#123;</span><br><span class="line">        director.<span class="title function_">loadScene</span>(<span class="title class_">CustomEventData</span>);<span class="comment">//加载场景</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后保存脚本文件与场景文件，点击编辑器上方的开始按钮(地球右边、“当前场景”左边的三角形)，不出意外的话会以浏览器的方式打开你的游戏。这里最好按F12打开控制台</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220717194829425.png" alt="用浏览器调试游戏"></p>
<p>如果你的界面里有一个按钮，点击它以后控制台提示<strong>LoadScene game: xxx ms</strong>，说明你就成功了！</p>
<h3 id="游戏元素"><a href="#游戏元素" class="headerlink" title="游戏元素"></a>游戏元素</h3><p>好！你进入了游戏场景，可以开始准备制作这个场景里的每个元素了</p>
<p>以下面这个<a target="_blank" rel="noopener" href="http://flappybird.io/">FlappyBird</a>为例</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-1.gif" alt="FlappyBird"></p>
<p>这个游戏场景包含下面几个元素</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220722221006045.png" alt="游戏元素"></p>
<p>为了让这些元素组合在一起，还要动起来，这里还需要一个脚本来驱动它们。打开之前新建的GameManager脚本，让我们来一个个制作并应用这些元素</p>
<h4 id="计分板"><a href="#计分板" class="headerlink" title="计分板"></a>计分板</h4><p>还记得<a href="#1">之前</a>讲过的按钮吗？之所以选择先做计分板是因为创建计分板所在的标签(Label)会附带一个画布(Canvas),这个画布又包含了一个摄像机(Camera)，这正好能拿来当游戏的视角</p>
<p>在游戏场景的节点下新建一个Label，命名为lb_score，再把它的位置往上移，比如到y轴250的位置，再调整一下文本的字号，Label的大小会随文本大小而变化</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220722235134220.png" alt="新建标签与修改字号"></p>
<ul>
<li>这个Label的坐标是<strong>相对于他的父节点的</strong>，所有节点的坐标都是<strong>相对坐标</strong></li>
</ul>
<p>这里先把这个标签放着，后面会讲到怎么修改它</p>
<h4 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h4><p>这里的角色——也就是你点一下就会跳一下的鸟。虽然看起来朴实无华，但是也包含很多细节：</p>
<ol>
<li>他在移动</li>
<li>他知道你和他交互(这里以按下鼠标左键为例)</li>
<li>他在你交互过后有反应(跳了一下)</li>
<li>他会知道自己有没有撞上障碍物</li>
<li>他知道自己钻过障碍物后会得一分</li>
<li>…</li>
</ol>
<p>这里咱一个个来讲</p>
<p>虽然看起来鸟是在向右移动，然后经过一个又一个静止不动的障碍物，比如下图</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220723171309655.png" alt="移动方向"></p>
<p>但在游戏的实际制作中，通常会让角色保持<strong>与镜头水平方向上的的相对静止</strong>，让场景相对角色方向运动。比较典型的例子有<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV14W411w7jK">Muse Dash</a>。这样的做法不用移动摄像机，看起来就像坐在剧院台下看着上面的演员和背景演了一出戏。所以只用实现角色的上下移动就行了</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220723172359859.png" alt="实际移动方向"></p>
<p>这里我们在根节点下新建一个3D对象-球体，命名为Bird，将他的位置(Position)设定在(160,320,0)，大小(Scale)设置为(20,20,20)，再把渲染层级(Layer)改为None，让他能不受限制地被摄像机渲染出来</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220723174317723.png" alt="新建Bird"></p>
<p>我们再为他新建一个脚本，命名为BirdCtrl，我们会用来让它动起来</p>
<h5 id="开启物理系统"><a href="#开启物理系统" class="headerlink" title="开启物理系统"></a>开启物理系统</h5><p>首先，我们先来实现起跳。其实跳跃无非就是让他当前的垂直速度变为向上，为了操作物体的速度，引擎里需要我们把这个物体变为<strong>刚体</strong>(RigidBody)，通俗来讲就是把他变成实心的，能够感知这个物理世界。为此，我们需要为Bird添加刚体组件</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-2.gif" alt="添加刚体组件"></p>
<p>打开BirdCtrl，在类内声明一个<strong>带有属性装饰器的变量</strong>（由英译汉下称<strong>资产变量</strong>）Bird用于指向鸟儿，类型为Node</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//鸟所在的节点</span></span><br><span class="line"><span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line"><span class="title class_">Bird</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br></pre></td></tr></table></figure>

<blockquote>
<p>带有@property声明属性的资产变量与普通变量最大的区别是<strong>能在编辑器内拖拽并应用内容</strong></p>
</blockquote>
<p>再在start函数里补充这一句</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="title function_">setLinearVelocity</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">300</span>,<span class="number">0</span>));<span class="comment">//设置线性速度</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个语句作用是在Bird节点里<strong>按名字寻找</strong>刚体组件，再调用组件里<strong>设定线性速度</strong>的方法，参数是<strong>三维坐标对象v3</strong></p>
</blockquote>
<p>保存代码，将BirdCtrl脚本拖入节点树中，将Bird拖入右侧的栏位中，保存场景。这时候运行游戏你就能发现一个向上飞的小球(你的鸟)了</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-3.gif" alt="应用脚本"></p>
<h5 id="开启输入监听"><a href="#开启输入监听" class="headerlink" title="开启输入监听"></a>开启输入监听</h5><p>但光让他自己不受限制地移动显然不够，他还需要听我们的话，我们点一下鼠标他就跳一下。为了让游戏引擎知道我们在点击鼠标，这里我们需要<strong>开启鼠标监听</strong></p>
<p>将刚才复制进start函数里的内容写进新的函数里，比如onMouseClick。在start函数里加入如下语句</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">input.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">MOUSE_DOWN</span>,<span class="variable language_">this</span>.<span class="property">onMouseClick</span>,<span class="variable language_">this</span>);<span class="comment">//开启输入监听</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个语句用于开启输入监听，第一个参数指定监听类型（这里是监听鼠标按下），第二个参数指定触发的函数回调，第三个参数指定触发的目标，一般都是this</p>
</blockquote>
<p>而函数为了接受来自输入监听的触发，需要添加EventMouse类型的形参作为输入，就像这样</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onMouseClick</span>(<span class="params">event: EventMouse</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="title function_">setLinearVelocity</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">300</span>,<span class="number">0</span>));<span class="comment">//设置线性速度</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后你的鸟就会在你点击鼠标之后跳起来了</p>
<h5 id="调整物理世界参数"><a href="#调整物理世界参数" class="headerlink" title="调整物理世界参数"></a>调整物理世界参数</h5><p>接着，我们再来实现下落，这里依靠游戏内物理引擎的<strong>重力</strong>来实现。你可能已经注意到了，在之前开启刚体组件的时候就已经有重力下落了。但很显然，这点蚊子腿的下落速度肯定不够看。为此，我们需要调整<strong>世界重力</strong>和物体的<strong>速度阻尼</strong></p>
<p>在start函数里写入</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">PhysicsSystem</span>.<span class="property">instance</span>.<span class="property">gravity</span>=<span class="title function_">v3</span>(<span class="number">0</span>,-<span class="number">500</span>,<span class="number">0</span>);<span class="comment">//设置重力</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个语句调整了<strong>物理系统</strong>实例的重力参数，其值是一个三维坐标</p>
</blockquote>
<p>和</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="property">linearDamping</span>=<span class="number">0.1</span>;<span class="comment">//设置线性阻尼</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个语句设置了刚体里线性阻尼的值，其值是一个数，数字越大，速度衰减越快</p>
</blockquote>
<p>最终代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BirdCtrl.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">RigidBody</span>, v3, input, <span class="title class_">Input</span>, <span class="title class_">EventMouse</span>, <span class="title class_">PhysicsSystem</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;BirdCtrl&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BirdCtrl</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//鸟所在的节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Bird</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        input.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">MOUSE_DOWN</span>,<span class="variable language_">this</span>.<span class="property">onMouseClick</span>,<span class="variable language_">this</span>);<span class="comment">//开启输入监听</span></span><br><span class="line">        <span class="title class_">PhysicsSystem</span>.<span class="property">instance</span>.<span class="property">gravity</span>=<span class="title function_">v3</span>(<span class="number">0</span>,-<span class="number">500</span>,<span class="number">0</span>);<span class="comment">//设置重力</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="property">linearDamping</span>=<span class="number">0.1</span>;<span class="comment">//设置速度阻尼</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onMouseClick</span>(<span class="params">event: EventMouse</span>)&#123;<span class="comment">//鼠标输入</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="title function_">setLinearVelocity</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">300</span>,<span class="number">0</span>));<span class="comment">//更改速度为向上</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候保存代码和场景并运行，你就能看到一只听你指挥的鸟了</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-4.gif" alt="测试输入与反馈"></p>
<h4 id="障碍物"><a href="#障碍物" class="headerlink" title="障碍物"></a>障碍物</h4><p>有了上面的例子，障碍物的实现其实很简单。鉴于障碍物需要重复生成很多次，这里使用<strong>预制体</strong>(Prefab)来构造。在资源管理器里新建一个预制体，命名为brick，双击打开它。在里面新建两个圆柱体，命名为Up和Down，把它们的尺寸调整为(30,500,30)，坐标分别调整为(0,±550,0)，再把它的渲染层级调整为None，这样，你就得到了一个简略的障碍物</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220724000315146.png" alt="使用预制体制作障碍物"></p>
<p>有了障碍物，接下来就要思考怎么把他应用在场景里了。这里分解成三个部分</p>
<ol>
<li>障碍物的生成</li>
<li>障碍物的移动</li>
<li>障碍物的碰撞检测</li>
</ol>
<p>这里一个个来说</p>
<h5 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h5><p>我们需要将障碍物<strong>实例化</strong>(instantiate)生成到场景里。打开GameManager脚本，在类内声明一个资产变量pref_Brick用于指向障碍物的预制体，类型为Prefab。再声明一个函数，命名为summonBricks。在函数里加入如下语句</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//障碍物</span></span><br><span class="line"><span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line"><span class="keyword">private</span> <span class="attr">pref_Brick</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">summonBricks</span>(<span class="params"></span>)&#123;<span class="comment">//是否定义为私有不影响，下同</span></span><br><span class="line">    <span class="keyword">const</span> newBrick=<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">pref_Brick</span>);<span class="comment">//实例化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>instantiate(Prefab)方法可以把一个预制体<strong>实例化</strong>，使其成为一个节点，其参数为一个预制体。同时，该节点也是方法的返回值，可以赋值给变量用于后续操作</p>
</blockquote>
<p>但是，仅仅是实例化还不够，这个预制体的实例还不知道他在节点树的位置，也不知道他在场景里的相对位置。所以，我们需要额外声明一个资产变量nd_BrickPlace用于指向生成障碍物的位置</p>
<p>同时，在Canvas下新建一个名为BrickPlace的空节点，把他拖到Canvas内的位置(方便测试的时候看就行)。此外，在summonBricks函数中补充如下语句</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">addChild</span>(newBrick);<span class="comment">//添加子节点</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>node.addChild(Node)方法用于向父节点添加子节点，参数为一个节点</p>
</blockquote>
<p>和</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newBrick.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));<span class="comment">//设置节点的相对位置</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>node.setPosition(v3)方法用于设置节点的相对位置，参数为一个三维坐标</p>
</blockquote>
<p>最后，在start函数里调用这个函数，保存。目前代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, math, v3, instantiate, tween &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123; </span><br><span class="line">    <span class="comment">//障碍物</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">pref_Brick</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//障碍物生成节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nd_BrickPlace</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonBricks</span>(<span class="params"></span>)&#123;<span class="comment">//是否定义为私有不影响，下同</span></span><br><span class="line">        <span class="keyword">const</span> newBrick=<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">pref_Brick</span>);<span class="comment">//实例化</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">addChild</span>(newBrick);<span class="comment">//添加子节点</span></span><br><span class="line">        newBrick.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));<span class="comment">//设置节点的相对位置</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">summonBricks</span>();</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在场景节点下应用GameManager脚本，并在编辑器内应用障碍物预制体和生成节点，保存并运行查看结果</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220724225149224.png" alt="应用脚本与节点"></p>
<p>能在屏幕内看到生成的障碍物，说明目前为止你成功了！</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220725000219869.png" alt="测试障碍物生成"></p>
<ul>
<li>部分人可能会遇到一根歪障碍物，这是因为你的主摄像机还保持着默认状态，他与Canvas里的摄像机视角是<strong>叠加</strong>的，所以你只要在场景里把主摄像机挪开，转个向就可以了(但不要删掉，他还负责背景的显示)</li>
</ul>
<p>但只生成一次障碍物显然不够，我们需要更多的障碍物才能保持持续的游戏体验。因此，我们可以使用一个计时器来实现</p>
<p>在GameManager里声明一个变量Timer与一个函数checkTimer，代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计时器</span></span><br><span class="line"><span class="keyword">private</span> <span class="title class_">Timer</span> = <span class="number">0</span>;<span class="comment">//全局变量</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">checkTimer</span>(<span class="params"></span>)&#123;<span class="comment">//每一定间隔生成障碍物</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">Timer</span>&lt;<span class="number">300</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Timer</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Timer</span>=<span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">summonBricks</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Summon&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>这个代码逻辑是每调用300次这个函数就会生成一个障碍物</li>
</ul>
<p>在update函数里调用这个函数。保存脚本与场景，运行测试一下。打开浏览器的F12控制台，如果你能看到周期性产出的“Summon”就算成功了</p>
<blockquote>
<p>update函数会在游戏的<strong>每一帧</strong>调用一次，所以相当于每 300帧生成一个障碍物</p>
</blockquote>
<p>接着，我们来做一点小小的优化。你想一下，那些鸟儿已经穿过的障碍物最终的归宿是哪里？如果没有后续操作的话，他们会一直停留在你的屏幕外无所事事。久而久之(如果你玩的足够久的话)，这些砖块就会积压在场景里，让你的游戏变得卡顿。所以我们需要定期清理这些没用的障碍物</p>
<p>因此，我们来新建一个数组，命名为allBricks，把他当成一个<strong>队列</strong>看。在summonBricks函数里加入如下语句</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="title function_">push</span>(newBrick)<span class="comment">//入队尾</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="property">length</span>&gt;<span class="number">8</span>)&#123;<span class="comment">//判断队列长度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="title function_">shift</span>().<span class="title function_">destroy</span>()<span class="comment">//队首出队并销毁</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>node.destory()方法会在下一帧开始前销毁这个节点</p>
</blockquote>
<p>当数组长度大于8的时候会把最先生成的那一个障碍物拿出并销毁，这样就达成了优化的目的</p>
<h5 id="移动"><a href="#移动" class="headerlink" title="移动"></a>移动</h5><p>现在我们生成了砖块，但是他们只会傻乎乎地待在原地，所以我们需要使用<strong>缓动</strong>(Tween)实例让它动起来。在summonBricks函数后面加入如下语句</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">tween</span>(newBrick)</span><br><span class="line">    .<span class="title function_">to</span>(<span class="number">20</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-<span class="number">2000</span>,<span class="number">0</span>,<span class="number">0</span>)&#125;)</span><br><span class="line">    .<span class="title function_">delay</span>(<span class="number">500</span>)</span><br><span class="line">    .<span class="title function_">start</span>();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>tween(Node)方法是让一个节点连贯地动起来，其参数是一个节点每一个’.’后都是一个方法，可自由排列</p>
<p>to(time,todo)告诉实例这个节点将要做什么，time是时间，单位为秒，todo是一个由大括号括起来的键值对，表明这个动作的目的</p>
<p>delay(time)为延迟时间，单位为毫秒</p>
<p>start()为开始</p>
</blockquote>
<p>保存并测试</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220725123723916.png" alt="障碍物生成"></p>
<p>接着你就会发现，这些障碍物只会生成在同一个高度。这时就需要我们为他添加随机性</p>
<p>在GameManager内声明一个变量rand，为其赋值一个随机数，比如</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> rand = math.<span class="title function_">randomRange</span>(-<span class="number">200</span>,<span class="number">200</span>);<span class="comment">//随机数</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>math.randomRange(a,b)会返回[a,b)区间的随机<strong>浮点</strong>数</p>
</blockquote>
<p>然后把rand的值赋给tween方法里的position坐标和brick生成的坐标，保存脚本与场景。这时你再运行就能看到随机位置的障碍物了</p>
<p>目前GameManager代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, math, v3, instantiate, tween &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//障碍物</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">pref_Brick</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//障碍物生成节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nd_BrickPlace</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//计时器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Timer</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">//所有砖块</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">allBricks</span>:<span class="title class_">Node</span>[] = []</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonBricks</span>(<span class="params"></span>)&#123;<span class="comment">//生成砖块</span></span><br><span class="line">        <span class="keyword">let</span> rand = math.<span class="title function_">randomRange</span>(-<span class="number">200</span>,<span class="number">200</span>);<span class="comment">//随机数</span></span><br><span class="line">        <span class="keyword">const</span> newBrick=<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">pref_Brick</span>);<span class="comment">//实例化</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">addChild</span>(newBrick);<span class="comment">//添加子节点</span></span><br><span class="line">        newBrick.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,rand,<span class="number">0</span>));<span class="comment">//设置节点的相对位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="title function_">push</span>(newBrick)<span class="comment">//入队尾</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="property">length</span>&gt;<span class="number">8</span>)&#123;<span class="comment">//判断队列长度</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="title function_">shift</span>().<span class="title function_">destroy</span>()<span class="comment">//队首出队并销毁</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">tween</span>(newBrick)<span class="comment">//移动</span></span><br><span class="line">        .<span class="title function_">to</span>(<span class="number">20</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-<span class="number">2000</span>,rand,<span class="number">0</span>)&#125;)</span><br><span class="line">        .<span class="title function_">delay</span>(<span class="number">500</span>)</span><br><span class="line">        .<span class="title function_">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">checkTimer</span>(<span class="params"></span>)&#123;<span class="comment">//每一定间隔生成砖块</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">Timer</span>&lt;<span class="number">300</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Timer</span>++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Timer</span>=<span class="number">0</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">summonBricks</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Summon&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">summonBricks</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">checkTimer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="碰撞检测"><a href="#碰撞检测" class="headerlink" title="碰撞检测"></a>碰撞检测</h5><p>为了让这个游戏能够结束，我们需要添加失败条件——鸟儿撞上障碍物。因此，我们需要进行碰撞检测。在此之前，我们已经给鸟儿开启了刚体，让他能感知这个物理世界。为了能够感知到其他物体的接触，我们还需要另外一件东西——<strong>碰撞箱</strong>(Collider)</p>
<p>首先，先为鸟儿添加SphereCollider组件。同样地，再为障碍物的上下两端添加碰撞箱，这次选择CylinderCollider，并勾选is Trigger(触发器与普通碰撞箱的区别是是否会产生物理反馈（弹开or穿模）)。接着打开BirdCtrl，声明一个新函数onHit。由于现在我们还没有控制游戏进程的状态机，所以内容暂时先填console.log(“Hit”)。在start函数里加入如下语句</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>).<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">onHit</span>,<span class="variable language_">this</span>) <span class="comment">//开启碰撞检测</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个语句获取了碰撞箱基类(SphereCollider的父类)的组件，然后开启碰撞箱组件的碰撞检测，第一个参数指定监听类型（这里是监听一个<strong>触发器</strong>与碰撞箱开始接触），第二个参数指定触发的函数回调，第三个参数指定触发的目标，一般都是this</p>
</blockquote>
<p>由于是碰撞事件，因此我们还需要在onHit函数的形参添加类型为ICollisionEvent的形参。保存并测试，如果你的鸟撞上了障碍物，你应该能够在控制台里看到输出“Hit”了</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220726203910465.png" alt="碰撞测试"></p>
<p>目前代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BirdCtrl.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">RigidBody</span>, v3, input, <span class="title class_">Input</span>, <span class="title class_">EventMouse</span>, <span class="title class_">PhysicsSystem</span>, <span class="title class_">Collider</span>, <span class="title class_">ICollisionEvent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;BirdCtrl&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BirdCtrl</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//鸟所在的节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Bird</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        input.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">MOUSE_DOWN</span>,<span class="variable language_">this</span>.<span class="property">onMouseClick</span>,<span class="variable language_">this</span>);<span class="comment">//开启输入监听</span></span><br><span class="line">        <span class="title class_">PhysicsSystem</span>.<span class="property">instance</span>.<span class="property">gravity</span>=<span class="title function_">v3</span>(<span class="number">0</span>,-<span class="number">500</span>,<span class="number">0</span>);<span class="comment">//设置重力</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="property">linearDamping</span>=<span class="number">0.1</span>;<span class="comment">//设置速度阻尼</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>).<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">onHit</span>,<span class="variable language_">this</span>)<span class="comment">//开启碰撞检测 </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onMouseClick</span>(<span class="params">event: EventMouse</span>)&#123;<span class="comment">//鼠标输入</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="title function_">setLinearVelocity</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">300</span>,<span class="number">0</span>));<span class="comment">//更改速度为向上</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onHit</span>(<span class="params">event: ICollisionEvent</span>)&#123;<span class="comment">//撞上障碍物</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hit&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="游戏机制"><a href="#游戏机制" class="headerlink" title="游戏机制"></a>游戏机制</h3><h4 id="状态机"><a href="#状态机" class="headerlink" title="状态机"></a>状态机</h4><p>游戏的<a href="#2">逻辑</a>需要一个东西来区分当前状态和控制游戏流程，这个东西就是<strong>状态机</strong>。简单来说，一个状态机会在游戏进入对应状态时执行一定操作，比如开始时加载游戏素材，死亡时结算分数。这样的做法有利于区分代码，减少代码的耦合度，总之就是方便你写和看</p>
<p>打开GameManager，在<strong>类外</strong>声明一个枚举变量EnumGameStatus，里面声明4种游戏状态</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">EnumGameStatus</span>&#123;<span class="comment">//游戏状态</span></span><br><span class="line">    init=<span class="number">1</span>,<span class="comment">//初始化</span></span><br><span class="line">    idle=<span class="number">2</span>,<span class="comment">//游玩</span></span><br><span class="line">    pause=<span class="number">3</span>,<span class="comment">//暂停</span></span><br><span class="line">    die=<span class="number">4</span>,<span class="comment">//死亡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先声明一个普通变量_GameStatus，再使用set&#x2F;get的方式声明一个变量GameStatus</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//游戏状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="attr">_gameStatus</span>:<span class="title class_">EnumGameStatus</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="title function_">gameStatus</span>(<span class="params">status:EnumGameStatus</span>)&#123;</span><br><span class="line">    <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">init</span>:<span class="comment">//初始化</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:init&quot;</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">scheduleOnce</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>;</span><br><span class="line">            &#125;,<span class="number">0.2</span>)<span class="comment">//延迟0.2s后切换状态</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>:</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:idle&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">pause</span>:</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:pause&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>:</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:die&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error:Wrong game status!&quot;</span>)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_gameStatus</span>=status;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">get</span> <span class="title function_">gameStatus</span>()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_gameStatus</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>scheduleOnce是一个一次性定时器，第一个参数是一个函数，这里使用<strong>匿名函数</strong>是为了避免变量的定义域的问题，第二个参数是时间，单位为秒</p>
</blockquote>
<blockquote>
<p>set&#x2F;get是一对<strong>存取器</strong>，可以在赋值和读取的时候执行额外操作，这里使用set方式赋值变量可以让变量的值限制在一个范围内</p>
</blockquote>
<blockquote>
<p>使用存取器时分别使用var和_var两个变量是必要要求，也有助于代码阅读，这里是为了防止变量被意外篡改</p>
</blockquote>
<p>然后我们在各个函数里加入对应游戏状态的赋值语句，在GameManager的start函数里加入如下语句</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">init</span>;<span class="comment">//初始化游戏</span></span><br></pre></td></tr></table></figure>

<p>接着在BirdCtrl里声明一个资产变量GameManagerScript用于指向GameManager组件所在的节点，类型为GameManager，由于权限控制的关系，这里需要引用它来对GameManager的变量进行操作</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameManager脚本</span></span><br><span class="line"><span class="meta">@property</span>(<span class="title class_">GameManager</span>)</span><br><span class="line"><span class="title class_">GameManagerScript</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!</span><br></pre></td></tr></table></figure>

<p>然后在onHit函数里加入如下语句</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">GameManagerScript</span>.<span class="property">gameStatus</span> = <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;<span class="comment">//碰撞后死亡</span></span><br></pre></td></tr></table></figure>

<p>保存脚本，在BirdCtrl节点里应用GameManager节点，保存场景，测试</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-5.gif" alt="输出测试"></p>
<p>控制台出现以上输出就算成功！</p>
<p>目前代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, math, v3, instantiate, tween &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">EnumGameStatus</span>&#123;<span class="comment">//游戏状态</span></span><br><span class="line">    init=<span class="number">1</span>,<span class="comment">//初始化</span></span><br><span class="line">    idle=<span class="number">2</span>,<span class="comment">//游玩</span></span><br><span class="line">    pause=<span class="number">3</span>,<span class="comment">//暂停</span></span><br><span class="line">    die=<span class="number">4</span>,<span class="comment">//死亡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//障碍物</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">pref_Brick</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//障碍物生成节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nd_BrickPlace</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//计时器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Timer</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">//所有砖块</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">allBricks</span>:<span class="title class_">Node</span>[] = []</span><br><span class="line">    <span class="comment">//游戏状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_gameStatus</span>:<span class="title class_">EnumGameStatus</span> = <span class="number">0</span>;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//更新、获取游戏状态</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">gameStatus</span>(<span class="params">status:EnumGameStatus</span>)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">init</span>:<span class="comment">//初始化</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:init&quot;</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">scheduleOnce</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>;</span><br><span class="line">                &#125;,<span class="number">0.2</span>)<span class="comment">//延迟0.2s后切换状态</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:idle&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">pause</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:pause&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:die&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error:Wrong game status!&quot;</span>)</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_gameStatus</span>=status;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">gameStatus</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_gameStatus</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonBricks</span>(<span class="params"></span>)&#123;<span class="comment">//生成砖块</span></span><br><span class="line">        <span class="keyword">let</span> rand = math.<span class="title function_">randomRange</span>(-<span class="number">200</span>,<span class="number">200</span>);<span class="comment">//随机数</span></span><br><span class="line">        <span class="keyword">const</span> newBrick=<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">pref_Brick</span>);<span class="comment">//实例化</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">addChild</span>(newBrick);<span class="comment">//添加子节点</span></span><br><span class="line">        newBrick.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,rand,<span class="number">0</span>));<span class="comment">//设置节点的相对位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="title function_">push</span>(newBrick)<span class="comment">//入队尾</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="property">length</span>&gt;<span class="number">8</span>)&#123;<span class="comment">//判断队列长度</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="title function_">shift</span>().<span class="title function_">destroy</span>()<span class="comment">//队首出队并销毁</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">tween</span>(newBrick)<span class="comment">//移动</span></span><br><span class="line">        .<span class="title function_">to</span>(<span class="number">20</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-<span class="number">2000</span>,rand,<span class="number">0</span>)&#125;)</span><br><span class="line">        .<span class="title function_">delay</span>(<span class="number">500</span>)</span><br><span class="line">        .<span class="title function_">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">checkTimer</span>(<span class="params"></span>)&#123;<span class="comment">//每一定间隔生成砖块</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">Timer</span>&lt;<span class="number">300</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Timer</span>++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Timer</span>=<span class="number">0</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">summonBricks</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Summon&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">summonBricks</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">init</span>;<span class="comment">//初始化游戏</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">checkTimer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BirdCtrl.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">RigidBody</span>, v3, input, <span class="title class_">Input</span>, <span class="title class_">EventMouse</span>, <span class="title class_">PhysicsSystem</span>, <span class="title class_">Collider</span>, <span class="title class_">ICollisionEvent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnumGameStatus</span>, <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;BirdCtrl&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BirdCtrl</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//鸟所在的节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Bird</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//GameManager脚本</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">GameManager</span>)</span><br><span class="line">    <span class="title class_">GameManagerScript</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        input.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">MOUSE_DOWN</span>,<span class="variable language_">this</span>.<span class="property">onMouseClick</span>,<span class="variable language_">this</span>);<span class="comment">//开启输入监听</span></span><br><span class="line">        <span class="title class_">PhysicsSystem</span>.<span class="property">instance</span>.<span class="property">gravity</span>=<span class="title function_">v3</span>(<span class="number">0</span>,-<span class="number">500</span>,<span class="number">0</span>);<span class="comment">//设置重力</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="property">linearDamping</span>=<span class="number">0.1</span>;<span class="comment">//设置速度阻尼</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">Collider</span>).<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">onHit</span>,<span class="variable language_">this</span>)<span class="comment">//开启碰撞检测 </span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">onMouseClick</span>(<span class="params">event: EventMouse</span>)&#123;<span class="comment">//鼠标输入</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="title function_">setLinearVelocity</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">300</span>,<span class="number">0</span>));<span class="comment">//更改速度为向上</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onHit</span>(<span class="params">event: ICollisionEvent</span>)&#123;<span class="comment">//撞上障碍物</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hit&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GameManagerScript</span>.<span class="property">gameStatus</span> = <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;<span class="comment">//碰撞后死亡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="得分判定"><a href="#得分判定" class="headerlink" title="得分判定"></a>得分判定</h4><p>每次成功钻过一个障碍物，玩家就可以得一分。这个逻辑我们还是交给碰撞箱来实现</p>
<p>首先在GameManager里声明一个资产变量lb_score用于指向计分板的节点，类型为Label，然后使用get&#x2F;set存取器的方式声明变量score，再声明一个number(<strong>大小写敏感</strong>)类型的_score</p>
<p>在set score的同时我们可以对计分板的内容进行操作，比如下面的代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计分板节点</span></span><br><span class="line"><span class="meta">@property</span>(<span class="title class_">Label</span>)</span><br><span class="line"><span class="keyword">private</span> <span class="attr">lb_score</span>:<span class="title class_">Label</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">//分数</span></span><br><span class="line"><span class="keyword">public</span> <span class="attr">_score</span>:<span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//设置、获取分数</span></span><br><span class="line"><span class="keyword">set</span> <span class="title function_">score</span>(<span class="params">score:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`Score:<span class="subst">$&#123;score&#125;</span>`</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_score</span>=score;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">get</span> <span class="title function_">score</span>()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_score</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>label.string是一个标签(Label)的字符串内容，可以通过赋值修改</p>
<p>带有引用内容的字符串使用 <strong>&#96;&#96;</strong> 而不是 “” ，对于引用的内容遵循这个语法: <strong>${var}</strong></p>
</blockquote>
<p>在brick预制体里新建一个空节点Score，为其添加一个方形碰撞箱，大小为(1,100,30)（Node的scale或者BoxCollider的size都行），并勾选is Trigger</p>
<p>在BirdCtrl里添加第二个SphereCollider组件。因为出现了同名组件，我们需要在BirdCtrl里使用getComponents而非getComponent，因此我们需要对原有代码进行修改</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//this.Bird.getComponent(Collider).on(&#x27;onTriggerEnter&#x27;,this.onHit,this)//原来的开启碰撞检测</span></span><br><span class="line"><span class="keyword">let</span> coms=<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponents</span>(<span class="title class_">SphereCollider</span>);<span class="comment">//两个球体碰撞箱组件</span></span><br><span class="line">coms[<span class="number">0</span>].<span class="title function_">on</span>(<span class="string">&#x27;onCollisionEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">onHit</span>,<span class="variable language_">this</span>);<span class="comment">//第一个碰撞箱，不使用触发器，对障碍物进行判断</span></span><br><span class="line">coms[<span class="number">1</span>].<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">getScore</span>,<span class="variable language_">this</span>)<span class="comment">//第二个碰撞箱，使用触发器，对分数进行判断</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>getComponents(Name)返回所有同名组件，数组内按他们在编辑器内的顺序自上而下排序</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BirdCtrl类内</span></span><br><span class="line"><span class="title function_">getScore</span>(<span class="params">event: ICollisionEvent</span>)&#123;<span class="comment">//一个新函数，用于判定加分</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Scored&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">GameManagerScript</span>.<span class="property">score</span>++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>因编者认知有限，本小节以下部分仅供参考，存在更优解（即编辑 项目-项目设置 内的碰撞矩阵来解决）</p>
</blockquote>
<p>这里出现了一个新问题。由于我们使用了两个碰撞箱，但两个碰撞箱<strong>无法相互区分</strong>自己需要对应判定的碰撞箱是哪个(撞上障碍物? or 得分? 他们都是Trigger触发器)，所以我们在这里使用一个取巧的方法：</p>
<p>将其中一个碰撞箱修改为监听普通碰撞onCollisionEnter，将其用于对障碍物的监听，同时把brick预制体里的上下两个障碍物的is Trigger<strong>取消勾选</strong>，这样虽然会让障碍物有物理反馈，但是鸟儿碰上障碍物就死亡(游戏终止)，从结果上来讲<strong>与是否是触发器并无关系</strong></p>
<p>出现这个问题的原因是，无论是得分或者是碰撞，我们一直以鸟儿为主体进行判断，假若分别以障碍物和鸟儿为主体分别进行碰撞和得分判断则没有这个问题（相当于只做好本职工作，只做一件事），但因为这样会在GameManager里引用障碍物的碰撞检测脚本，而障碍物的碰撞检测脚本又会引用GameManager，会引起循环依赖(circular reference)警告（相当于左脚踩右脚，载入不及时会出问题）。而以鸟儿为主体只需要引用GameManager一次即可</p>
<p>保存代码，将lb_score节点应用到GameManager节点内，保存场景并测试</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-6.gif" alt="碰撞与得分测试"></p>
<ul>
<li>目前尚未实现障碍物碰撞后的流程，能看到控制台输出Scored和Hit就可以了</li>
</ul>
<p>目前代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, math, v3, instantiate, tween, <span class="title class_">Label</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">EnumGameStatus</span>&#123;<span class="comment">//游戏状态</span></span><br><span class="line">    init=<span class="number">1</span>,<span class="comment">//初始化</span></span><br><span class="line">    idle=<span class="number">2</span>,<span class="comment">//游玩</span></span><br><span class="line">    pause=<span class="number">3</span>,<span class="comment">//暂停</span></span><br><span class="line">    die=<span class="number">4</span>,<span class="comment">//死亡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//障碍物</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">pref_Brick</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//障碍物生成节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nd_BrickPlace</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计分板节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">lb_score</span>:<span class="title class_">Label</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//计时器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Timer</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">//所有砖块</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">allBricks</span>:<span class="title class_">Node</span>[] = []</span><br><span class="line">    <span class="comment">//游戏状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_gameStatus</span>:<span class="title class_">EnumGameStatus</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//分数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_score</span>:<span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//更新、获取游戏状态</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">gameStatus</span>(<span class="params">status:EnumGameStatus</span>)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">init</span>:<span class="comment">//初始化</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:init&quot;</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">scheduleOnce</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>;</span><br><span class="line">                &#125;,<span class="number">0.2</span>)<span class="comment">//延迟0.2s后切换状态</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:idle&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">pause</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:pause&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:die&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error:Wrong game status!&quot;</span>)</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_gameStatus</span>=status;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">gameStatus</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_gameStatus</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//更新、获取游戏分数</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">score</span>(<span class="params">score:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`Score:<span class="subst">$&#123;score&#125;</span>`</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_score</span>=score;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">score</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_score</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonBricks</span>(<span class="params"></span>)&#123;<span class="comment">//生成砖块</span></span><br><span class="line">        <span class="keyword">let</span> rand = math.<span class="title function_">randomRange</span>(-<span class="number">200</span>,<span class="number">200</span>);<span class="comment">//随机数</span></span><br><span class="line">        <span class="keyword">const</span> newBrick=<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">pref_Brick</span>);<span class="comment">//实例化</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">addChild</span>(newBrick);<span class="comment">//添加子节点</span></span><br><span class="line">        newBrick.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,rand,<span class="number">0</span>));<span class="comment">//设置节点的相对位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="title function_">push</span>(newBrick)<span class="comment">//入队尾</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="property">length</span>&gt;<span class="number">8</span>)&#123;<span class="comment">//判断队列长度</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="title function_">shift</span>().<span class="title function_">destroy</span>()<span class="comment">//队首出队并销毁</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">tween</span>(newBrick)<span class="comment">//移动</span></span><br><span class="line">            .<span class="title function_">to</span>(<span class="number">20</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-<span class="number">2000</span>,rand,<span class="number">0</span>)&#125;)</span><br><span class="line">            .<span class="title function_">delay</span>(<span class="number">500</span>)</span><br><span class="line">            .<span class="title function_">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">checkTimer</span>(<span class="params"></span>)&#123;<span class="comment">//每一定间隔生成砖块</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">Timer</span>&lt;<span class="number">300</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Timer</span>++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Timer</span>=<span class="number">0</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">summonBricks</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Summon&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">summonBricks</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">init</span>;<span class="comment">//初始化游戏</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">checkTimer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BirdCtrl.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">RigidBody</span>, v3, input, <span class="title class_">Input</span>, <span class="title class_">EventMouse</span>, <span class="title class_">PhysicsSystem</span>, <span class="title class_">Collider</span>, <span class="title class_">ICollisionEvent</span>, <span class="title class_">SphereCollider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnumGameStatus</span>, <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;BirdCtrl&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BirdCtrl</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//鸟所在的节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Bird</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//GameManager脚本</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">GameManager</span>)</span><br><span class="line">    <span class="title class_">GameManagerScript</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        input.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">MOUSE_DOWN</span>,<span class="variable language_">this</span>.<span class="property">onMouseClick</span>,<span class="variable language_">this</span>);<span class="comment">//开启输入监听</span></span><br><span class="line">        <span class="title class_">PhysicsSystem</span>.<span class="property">instance</span>.<span class="property">gravity</span>=<span class="title function_">v3</span>(<span class="number">0</span>,-<span class="number">500</span>,<span class="number">0</span>);<span class="comment">//设置重力</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="property">linearDamping</span>=<span class="number">0.1</span>;<span class="comment">//设置速度阻尼</span></span><br><span class="line">        <span class="comment">//this.Bird.getComponent(Collider).on(&#x27;onTriggerEnter&#x27;,this.onHit,this)//原来的开启碰撞检测</span></span><br><span class="line">        <span class="keyword">let</span> coms=<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponents</span>(<span class="title class_">SphereCollider</span>);<span class="comment">//两个球体碰撞箱组件</span></span><br><span class="line">        coms[<span class="number">0</span>].<span class="title function_">on</span>(<span class="string">&#x27;onCollisionEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">onHit</span>,<span class="variable language_">this</span>);<span class="comment">//第一个碰撞箱，不使用触发器，对障碍物进行判断</span></span><br><span class="line">        coms[<span class="number">1</span>].<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">getScore</span>,<span class="variable language_">this</span>)<span class="comment">//第二个碰撞箱，使用触发器，对分数进行判断</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">onMouseClick</span>(<span class="params">event: EventMouse</span>)&#123;<span class="comment">//鼠标输入</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="title function_">setLinearVelocity</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">300</span>,<span class="number">0</span>));<span class="comment">//更改速度为向上</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onHit</span>(<span class="params">event: ICollisionEvent</span>)&#123;<span class="comment">//撞上障碍物</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hit&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GameManagerScript</span>.<span class="property">gameStatus</span> = <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;<span class="comment">//碰撞后死亡</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getScore</span>(<span class="params">event: ICollisionEvent</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Scored&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GameManagerScript</span>.<span class="property">score</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h4><h5 id="游戏暂停与恢复"><a href="#游戏暂停与恢复" class="headerlink" title="游戏暂停与恢复"></a>游戏暂停与恢复</h5><p>游戏玩一半想中途离开屏幕怎么办？这时就需要用到暂停了。一般来说，暂停的时候，游戏会干两件事：</p>
<ul>
<li>游戏世界暂停运行</li>
<li>呼出暂停菜单</li>
</ul>
<p>对于第一件事，引擎里有很方便的api可以调用。首先在编辑器内Canvas节点下新建一个按钮btn_Pause，把他拖到画布左上角充当暂停按钮，再新建一个MenuManager脚本，为按下暂停按钮准备一个函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">clickPauseBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//暂停游戏</span></span><br><span class="line">    director.<span class="title function_">pause</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>director.pause()用于暂停游戏的运行逻辑，但是UI，场景渲染之类的还会继续保持</p>
</blockquote>
<p>接着我们再来做暂停菜单，在Canvas节点下新建一个2D对象-单色，命名为pauseMenu，把他的大小调整到你认为合适的大小，比如宽500，高400，颜色你也可以选自己喜欢的。然后在pauseMenu里面新建两个按钮，一个用于恢复游戏，一个用于返回主菜单，最后最好再新建一个Label标签，把他的内容改为“暂停中”。大概长这样</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220731112337393.png" alt="暂停菜单样例"></p>
<p>然后我们回到MenuManager中，声明一个类型为Node的资产变量pauseMenu指向这个菜单，在start函数里加入如下语句</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏菜单</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>node.active用于控制节点的激活状态，默认为true</p>
</blockquote>
<p>然后在clickPauseBtn函数里加入上面的语句，但是这次要把false改为true</p>
<p>接着，我们为“继续”按钮新建一个函数clickResumeBtn，加入以下代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">clickResumeBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//恢复游戏</span></span><br><span class="line">    director.<span class="title function_">resume</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//关闭菜单</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>director.resume()用于恢复游戏逻辑的执行</p>
</blockquote>
<p>至于返回主菜单的按钮，把gameSceneChange脚本里的函数复制一份到MenuManager里就好了(或者在节点树里应用gameSceneChange脚本也行，二选其一)，记得填按钮的CustomEventData，这次是main</p>
<p>保存代码，在编辑器内应用两个按钮的ClickEvents(<a href="#1">参考这里</a>)和MenuManager脚本里的节点，保存场景并测试。如果可以实现以下情况就算成功</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-7.gif" alt="暂停测试"></p>
<p>目前代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MenuManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, director &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;MenuManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MenuManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">pauseMenu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏菜单</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">clickPauseBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//暂停游戏</span></span><br><span class="line">        director.<span class="title function_">pause</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickResumeBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//恢复游戏</span></span><br><span class="line">        director.<span class="title function_">resume</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//关闭菜单</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">changeScene</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//切换场景</span></span><br><span class="line">        director.<span class="title function_">loadScene</span>(<span class="title class_">CustomEventData</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="死亡结算"><a href="#死亡结算" class="headerlink" title="死亡结算"></a>死亡结算</h5><p>我们之前已经实现了状态机和碰撞后的状态切换，因此我们只需要在状态机切换到die的时候实现对应操作就可以了。具体来说就是当鸟儿撞上障碍物时，会执行以下操作：</p>
<ul>
<li>游戏场景停止继续运行</li>
<li>弹出一个界面，里面包括：<ul>
<li>一个标签告诉你这一局得了多少分</li>
<li>两个分别用于重新开始和返回主菜单的按钮</li>
</ul>
</li>
</ul>
<p>有了大致方向，我们就可以在编辑器里动手组装了。你可以参照上面的例子做一个差不多的。在Canvas节点下新建一个2D对象-单色，命名为endMenu，同样是两个按钮，一个命名为btn_replay，用于重新开始；一个命名为btn_returnMain，用于返回主菜单，以及一个标签，内容是你的分数。大概长这样</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220801174731726.png" alt="结算菜单样例"></p>
<p>接着，打开MenuManager，为重新开始的按钮写一个函数clickReplayBtn，当单击按钮的时候游戏会重新载入</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">clickReplayBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//游戏重新开始</span></span><br><span class="line">    director.<span class="title function_">loadScene</span>(<span class="title class_">CustomEventData</span>);<span class="comment">//重新载入场景</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时，别忘了在start函数里隐藏这个界面，因此，我们还需要声明一个资产变量endMenu用来指向这个菜单，类型为Node</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line"><span class="attr">endMenu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line"><span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏暂停菜单</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">endMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏结算菜单</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，我们来为游戏结束写一个函数gameEnd，因为涉及到修改结算界面里标签的文本，我们还需要一个资产变量lb_score指向那个标签，类型为Label。因为会用到GameManager脚本，所以我们还要需要声明一个GameManager类型的资产变量GameManagerScript用来指向他</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计分板节点</span></span><br><span class="line"><span class="meta">@property</span>(<span class="title class_">Label</span>)</span><br><span class="line"><span class="keyword">private</span> <span class="attr">lb_score</span>:<span class="title class_">Label</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">//GameManager节点</span></span><br><span class="line"><span class="meta">@property</span>(<span class="title class_">GameManager</span>)</span><br><span class="line"><span class="title class_">GameManagerScript</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line"><span class="title function_">gameEnd</span>(<span class="params"></span>)&#123;<span class="comment">//游戏结束</span></span><br><span class="line">    director.<span class="title function_">pause</span>()<span class="comment">//游戏场景暂停</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">endMenu</span>.<span class="property">active</span> = <span class="literal">true</span>;<span class="comment">//激活节点</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`您的分数为:<span class="subst">$&#123;<span class="variable language_">this</span>.GameManagerScript._score&#125;</span>`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，MenuManager部分就完成了。目前代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MenuManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, director, <span class="title class_">Label</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnumGameStatus</span>, <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;MenuManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MenuManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//暂停菜单</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">pauseMenu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//结算菜单</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">endMenu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//GameManager节点</span></span><br><span class="line">    <span class="comment">//这里与GameManager脚本形成循环依赖了，会有警告</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">GameManager</span>)</span><br><span class="line">    <span class="title class_">GameManagerScript</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计分板节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">lb_score</span>:<span class="title class_">Label</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏暂停菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">endMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏结算菜单</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">clickReplayBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//游戏重新开始</span></span><br><span class="line">        director.<span class="title function_">resume</span>()<span class="comment">//游戏场景恢复</span></span><br><span class="line">        director.<span class="title function_">loadScene</span>(<span class="title class_">CustomEventData</span>);<span class="comment">//重新载入场景</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickPauseBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//暂停游戏</span></span><br><span class="line">        director.<span class="title function_">pause</span>()<span class="comment">//游戏场景暂停</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickResumeBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//恢复游戏</span></span><br><span class="line">        director.<span class="title function_">resume</span>()<span class="comment">//游戏场景恢复</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//关闭菜单</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">changeScene</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//切换场景</span></span><br><span class="line">        director.<span class="title function_">loadScene</span>(<span class="title class_">CustomEventData</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">gameEnd</span>(<span class="params"></span>)&#123;<span class="comment">//游戏结束</span></span><br><span class="line">        director.<span class="title function_">pause</span>()<span class="comment">//游戏场景暂停</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">endMenu</span>.<span class="property">active</span> = <span class="literal">true</span>;<span class="comment">//激活节点</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`您的分数为:<span class="subst">$&#123;<span class="variable language_">this</span>.GameManagerScript._score&#125;</span>`</span><span class="comment">//修改文本</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着打开GameManager，在gameStatus切换到死亡状态的时候调用MenuManager里的gameEnd函数。同样地，我们需要一个资产变量来指向脚本，这次类型为MenuManager，代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MenuManager脚本</span></span><br><span class="line"><span class="comment">//这里与GameManager脚本形成循环依赖了，会有警告</span></span><br><span class="line"><span class="meta">@property</span>(<span class="title class_">MenuManager</span>)</span><br><span class="line"><span class="keyword">private</span> <span class="title class_">MenuManagerScript</span>:<span class="title class_">MenuManager</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">//gameStatus里的case，为了方便阅读上下代码省略</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>:</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:die&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">MenuManagerScript</span>.<span class="title function_">gameEnd</span>();<span class="comment">//执行游戏结束的函数</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>

<p>保存代码，在编辑器内应用资产变量所需要的节点与按钮的ClickEvents，保存场景</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220801183856343.png" alt="节点树"></p>
<p>运行，如果能实现下面的情形，就算成功了！</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-8.gif" alt="死亡结算"></p>
<ul>
<li>这里的重新开始还无法正常工作，因为我们还没有实现游戏的初始化</li>
</ul>
<h5 id="游戏初始化"><a href="#游戏初始化" class="headerlink" title="游戏初始化"></a>游戏初始化</h5><p>做完了前面所有的内容，现在终于可以一口气来做游戏的初始化了！初始化需要做的事情就是清理完上一把游戏剩下的内容，为新的一局游戏做好准备</p>
<p>在GameManager里新建一个函数init，我们需要让他实现下列功能</p>
<ul>
<li>分数归零</li>
<li>计时器归零</li>
<li>关闭所有界面</li>
<li>清除所有障碍物</li>
<li>生成第一个障碍物（已实现，在GameManager的start函数里，需转移代码位置）</li>
<li>判断场景状态</li>
<li>状态机切换（已实现，在GameManager的状态机内，需转移代码位置）</li>
</ul>
<p>代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gameStatus里的case，为了方便阅读上下代码省略</span></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">init</span>:<span class="comment">//初始化</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:init&quot;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>();<span class="comment">//初始化的函数</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">init</span>(<span class="params"></span>)&#123;<span class="comment">//初始化</span></span><br><span class="line">    <span class="keyword">if</span>(director.<span class="title function_">isPaused</span>())&#123;<span class="comment">//判断场景状态(是否二次加载)</span></span><br><span class="line">        director.<span class="title function_">resume</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">allBricks</span>=[];<span class="comment">//清除数组</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">removeAllChildren</span>();<span class="comment">//移除所有子节点（障碍物）</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">score</span>=<span class="number">0</span>;<span class="comment">//分数归零</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Timer</span>=<span class="number">0</span>;<span class="comment">//计时器归零</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">MenuManagerScript</span>.<span class="property">pauseMenu</span>.<span class="property">active</span>=<span class="literal">false</span>;<span class="comment">//关闭暂停菜单</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">MenuManagerScript</span>.<span class="property">endMenu</span>.<span class="property">active</span>=<span class="literal">false</span>;<span class="comment">//关闭结算菜单</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">summonBricks</span>();<span class="comment">//生成第一个障碍物</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">scheduleOnce</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>;</span><br><span class="line">    &#125;,<span class="number">0.2</span>)<span class="comment">//延迟0.2s后切换状态</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">init</span>;<span class="comment">//初始化游戏</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同样地，在BirdCtrl里新建一个函数init，需要实现的功能如下(其实就是把start函数的复制进去)</p>
<ul>
<li>设置重力</li>
<li>开启输入监听</li>
<li>开启碰撞检测</li>
<li>设置速度阻尼</li>
<li><strong>设置初始位置</strong>（这个不在start函数内，要自己写）</li>
</ul>
<p>代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">160</span>,<span class="number">320</span>,<span class="number">0</span>))<span class="comment">//设置初始位置</span></span><br><span class="line">    input.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">MOUSE_DOWN</span>,<span class="variable language_">this</span>.<span class="property">onMouseClick</span>,<span class="variable language_">this</span>);<span class="comment">//开启输入监听</span></span><br><span class="line">    <span class="title class_">PhysicsSystem</span>.<span class="property">instance</span>.<span class="property">gravity</span>=<span class="title function_">v3</span>(<span class="number">0</span>,-<span class="number">500</span>,<span class="number">0</span>);<span class="comment">//设置重力</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="property">linearDamping</span>=<span class="number">0.1</span>;<span class="comment">//设置速度阻尼</span></span><br><span class="line">    <span class="comment">//this.Bird.getComponent(Collider).on(&#x27;onTriggerEnter&#x27;,this.onHit,this)//原来的开启碰撞检测</span></span><br><span class="line">    <span class="keyword">let</span> coms=<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponents</span>(<span class="title class_">SphereCollider</span>);<span class="comment">//两个球体碰撞箱组件</span></span><br><span class="line">    coms[<span class="number">0</span>].<span class="title function_">on</span>(<span class="string">&#x27;onCollisionEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">onHit</span>,<span class="variable language_">this</span>);<span class="comment">//第一个碰撞箱，不使用触发器，对障碍物进行判断</span></span><br><span class="line">    coms[<span class="number">1</span>].<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">getScore</span>,<span class="variable language_">this</span>)<span class="comment">//第二个碰撞箱，使用触发器，对分数进行判断</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>node.setPosition(v3)用于设置节点的<strong>相对坐标</strong>，参数为一个三维坐标</p>
</blockquote>
<p>最后，为了应对场景切换带来的生命周期问题，我们还需要做一件额外的事情——把GameManager，BirdCtrl，MenuManager三个脚本各自的start函数内容移至onLoad函数内</p>
<blockquote>
<p>onLoad函数主要用在场景载入时触发，start函数更多用在onLoad完成后的内容加载</p>
</blockquote>
<p>最终代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, math, v3, instantiate, tween, <span class="title class_">Label</span>, director &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MenuManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./MenuManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">EnumGameStatus</span>&#123;<span class="comment">//游戏状态</span></span><br><span class="line">    init=<span class="number">1</span>,<span class="comment">//初始化</span></span><br><span class="line">    idle=<span class="number">2</span>,<span class="comment">//游玩</span></span><br><span class="line">    pause=<span class="number">3</span>,<span class="comment">//暂停</span></span><br><span class="line">    die=<span class="number">4</span>,<span class="comment">//死亡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//障碍物</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">pref_Brick</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//障碍物生成节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nd_BrickPlace</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计分板节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">lb_score</span>:<span class="title class_">Label</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//MenuManager脚本</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">MenuManager</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">MenuManagerScript</span>:<span class="title class_">MenuManager</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//计时器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Timer</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">//所有砖块</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">allBricks</span>:<span class="title class_">Node</span>[] = []</span><br><span class="line">    <span class="comment">//游戏状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_gameStatus</span>:<span class="title class_">EnumGameStatus</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//分数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_score</span>:<span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//更新、获取游戏状态</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">gameStatus</span>(<span class="params">status:EnumGameStatus</span>)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">init</span>:<span class="comment">//初始化</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:init&quot;</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">init</span>();<span class="comment">//初始化的函数</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:idle&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">pause</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:pause&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:die&quot;</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">MenuManagerScript</span>.<span class="title function_">gameEnd</span>();<span class="comment">//执行游戏结束的函数</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error:Wrong game status!&quot;</span>)</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_gameStatus</span>=status;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">gameStatus</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_gameStatus</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//更新、获取游戏分数</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">score</span>(<span class="params">score:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`Score:<span class="subst">$&#123;score&#125;</span>`</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_score</span>=score;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">score</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_score</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">init</span>(<span class="params"></span>)&#123;<span class="comment">//初始化</span></span><br><span class="line">        <span class="keyword">if</span>(director.<span class="title function_">isPaused</span>())&#123;<span class="comment">//判断场景状态(是否二次加载)</span></span><br><span class="line">            director.<span class="title function_">resume</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">allBricks</span>=[];<span class="comment">//清除数组</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">removeAllChildren</span>();<span class="comment">//移除所有子节点（障碍物）</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">score</span>=<span class="number">0</span>;<span class="comment">//分数归零</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Timer</span>=<span class="number">0</span>;<span class="comment">//计时器归零</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">MenuManagerScript</span>.<span class="property">pauseMenu</span>.<span class="property">active</span>=<span class="literal">false</span>;<span class="comment">//关闭暂停菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">MenuManagerScript</span>.<span class="property">endMenu</span>.<span class="property">active</span>=<span class="literal">false</span>;<span class="comment">//关闭结算菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">summonBricks</span>();<span class="comment">//生成第一个障碍物</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">scheduleOnce</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>;</span><br><span class="line">        &#125;,<span class="number">0.2</span>)<span class="comment">//延迟0.2s后切换状态</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonBricks</span>(<span class="params"></span>)&#123;<span class="comment">//生成砖块</span></span><br><span class="line">        <span class="keyword">let</span> rand = math.<span class="title function_">randomRange</span>(-<span class="number">200</span>,<span class="number">200</span>);<span class="comment">//随机数</span></span><br><span class="line">        <span class="keyword">const</span> newBrick=<span class="title function_">instantiate</span>(<span class="variable language_">this</span>.<span class="property">pref_Brick</span>);<span class="comment">//实例化</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">addChild</span>(newBrick);<span class="comment">//添加子节点</span></span><br><span class="line">        newBrick.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,rand,<span class="number">0</span>));<span class="comment">//设置节点的相对位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="title function_">push</span>(newBrick)<span class="comment">//入队尾</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="property">length</span>&gt;<span class="number">8</span>)&#123;<span class="comment">//判断队列长度</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">allBricks</span>.<span class="title function_">shift</span>().<span class="title function_">destroy</span>()<span class="comment">//队首出队并销毁</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">tween</span>(newBrick)<span class="comment">//移动</span></span><br><span class="line">        .<span class="title function_">to</span>(<span class="number">20</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-<span class="number">2000</span>,rand,<span class="number">0</span>)&#125;)</span><br><span class="line">        .<span class="title function_">delay</span>(<span class="number">500</span>)</span><br><span class="line">        .<span class="title function_">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">checkTimer</span>(<span class="params"></span>)&#123;<span class="comment">//每一定间隔生成砖块</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">Timer</span>&lt;<span class="number">300</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Timer</span>++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Timer</span>=<span class="number">0</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">summonBricks</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Summon&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">init</span>;<span class="comment">//初始化游戏</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">checkTimer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BirdCtrl.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">RigidBody</span>, v3, input, <span class="title class_">Input</span>, <span class="title class_">EventMouse</span>, <span class="title class_">PhysicsSystem</span>, <span class="title class_">ICollisionEvent</span>, <span class="title class_">SphereCollider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnumGameStatus</span>, <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;BirdCtrl&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BirdCtrl</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//鸟所在的节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Bird</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//GameManager脚本</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">GameManager</span>)</span><br><span class="line">    <span class="title class_">GameManagerScript</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">160</span>,<span class="number">320</span>,<span class="number">0</span>))<span class="comment">//设置初始位置</span></span><br><span class="line">        input.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">MOUSE_DOWN</span>,<span class="variable language_">this</span>.<span class="property">onMouseClick</span>,<span class="variable language_">this</span>);<span class="comment">//开启输入监听</span></span><br><span class="line">        <span class="title class_">PhysicsSystem</span>.<span class="property">instance</span>.<span class="property">gravity</span>=<span class="title function_">v3</span>(<span class="number">0</span>,-<span class="number">500</span>,<span class="number">0</span>);<span class="comment">//设置重力</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="property">linearDamping</span>=<span class="number">0.1</span>;<span class="comment">//设置速度阻尼</span></span><br><span class="line">        <span class="comment">//this.Bird.getComponent(Collider).on(&#x27;onTriggerEnter&#x27;,this.onHit,this)//原来的开启碰撞检测</span></span><br><span class="line">        <span class="keyword">let</span> coms=<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponents</span>(<span class="title class_">SphereCollider</span>);<span class="comment">//两个球体碰撞箱组件</span></span><br><span class="line">        coms[<span class="number">0</span>].<span class="title function_">on</span>(<span class="string">&#x27;onCollisionEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">onHit</span>,<span class="variable language_">this</span>);<span class="comment">//第一个碰撞箱，不使用触发器，对障碍物进行判断</span></span><br><span class="line">        coms[<span class="number">1</span>].<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">getScore</span>,<span class="variable language_">this</span>)<span class="comment">//第二个碰撞箱，使用触发器，对分数进行判断</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onMouseClick</span>(<span class="params">event: EventMouse</span>)&#123;<span class="comment">//鼠标输入</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="title function_">setLinearVelocity</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">300</span>,<span class="number">0</span>));<span class="comment">//更改速度为向上</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onHit</span>(<span class="params">event: ICollisionEvent</span>)&#123;<span class="comment">//撞上障碍物</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hit&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GameManagerScript</span>.<span class="property">gameStatus</span> = <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;<span class="comment">//碰撞后死亡</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getScore</span>(<span class="params">event: ICollisionEvent</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Scored&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">GameManagerScript</span>.<span class="property">score</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MenuManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, director, <span class="title class_">Label</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnumGameStatus</span>, <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;MenuManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MenuManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//暂停菜单</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">pauseMenu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//结算菜单</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">endMenu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//GameManager节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">GameManager</span>)</span><br><span class="line">    <span class="title class_">GameManagerScript</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计分板节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">lb_score</span>:<span class="title class_">Label</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏暂停菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">endMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏结算菜单</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">clickReplayBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//游戏重新开始</span></span><br><span class="line">        director.<span class="title function_">resume</span>()<span class="comment">//游戏场景恢复</span></span><br><span class="line">        director.<span class="title function_">loadScene</span>(<span class="title class_">CustomEventData</span>);<span class="comment">//重新载入场景</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickPauseBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//暂停游戏</span></span><br><span class="line">        director.<span class="title function_">pause</span>()<span class="comment">//游戏场景暂停</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickResumeBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//恢复游戏</span></span><br><span class="line">        director.<span class="title function_">resume</span>()<span class="comment">//游戏场景恢复</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//关闭菜单</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">changeScene</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//切换场景</span></span><br><span class="line">        director.<span class="title function_">loadScene</span>(<span class="title class_">CustomEventData</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">gameEnd</span>(<span class="params"></span>)&#123;<span class="comment">//游戏结束</span></span><br><span class="line">        director.<span class="title function_">pause</span>()<span class="comment">//游戏场景暂停</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">endMenu</span>.<span class="property">active</span> = <span class="literal">true</span>;<span class="comment">//激活节点</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`您的分数为:<span class="subst">$&#123;<span class="variable language_">this</span>.GameManagerScript._score&#125;</span>`</span><span class="comment">//修改文本</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="阶段性结尾"><a href="#阶段性结尾" class="headerlink" title="阶段性结尾"></a>阶段性结尾</h2><p>恭喜你！你已经完成了一个FlappyBird的原型demo了！同时，作为本文的编写者，我也十分感谢你能看到这里，谢谢你！</p>
<p>如果你愿意更进一步完善你的demo，你可以接着往下看</p>
<h2 id="进阶内容"><a href="#进阶内容" class="headerlink" title="进阶内容"></a>进阶内容</h2><ul>
<li>请注意，接下来的内容将不会像上面一样讲的十分细致，我只会简短地陈述我所做的事情。故内容门槛可能会提高</li>
</ul>
<h3 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a>代码优化</h3><h4 id="解决循环引用"><a href="#解决循环引用" class="headerlink" title="解决循环引用"></a>解决循环引用</h4><p>你可能会注意到，引擎里会有如下警告：</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220804175548524.png" alt="控制台警告"></p>
<p>出现这个的原因是我们在两个不同的类里互相引用了对方，类似于左脚踩右脚。理想情况下，对方的数据与函数应该是需要的时候拿来用一下，其他时间就不管了。但是在Cocos Creator中，@property装饰器 会先一步在声明类之前被解释，进而导致两个脚本互相打架（有可能出现一个脚本还没载入，却被另外一个脚本读取的情况，这样会导致undefined，具体表现为明明在脚本里有资产变量类型的声明，但编辑器内就是拖不进去）</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220804180326426.png" alt="一个例子(不在这个项目)"></p>
<p>解决方法：</p>
<ol>
<li>把变量的类型由类改为节点，在使用时getComponent(类名)</li>
<li>按类名索引而不是直接读取类，例如下面这样</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameManager节点</span></span><br><span class="line"><span class="meta">@property</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="title class_">GameManagerScript</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!</span><br></pre></td></tr></table></figure>

<p>这样控制台就不会报警了。但是，对于GameManager这种整个游戏就只有一个的脚本，还有一种更有效的方法，那就是：</p>
<h4 id="绑定单例"><a href="#绑定单例" class="headerlink" title="绑定单例"></a>绑定单例</h4><p>对于管理其他实例的类(比如GameManager，BirdCtrl)，全局只能有一个，多了就不知道谁控制谁了，这时我们就可以<strong>绑定单例</strong>来指代他。同时这样import后就可以直接使用了，而不用再去指定他的节点。以GameManager为例</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameManager.ts</span></span><br><span class="line"><span class="comment">//GameManager单例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="attr">instance</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!<span class="comment">//一定是静态的</span></span><br><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">GameManager</span>.<span class="property">instance</span> = <span class="variable language_">this</span>;<span class="comment">//绑定单例</span></span><br><span class="line">    <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">init</span>;<span class="comment">//初始化游戏</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在类内，你就可以把所有this换成GameManager.instance了，在类外，你也可以把原先使用GameManager类型变量的地方替换成GameManager.instance了</p>
<p>除此之外，我还加入了一些入口判断（比如在生成砖块的时候判定状态，如果是死亡状态就不会进一步生成砖块了），踢出了一些冗余代码（比如GameManager里init函数对MenuManager的操作，既然已经在MenuManager里实现过了就不用再来一遍了），目前代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, math, v3, instantiate, tween, <span class="title class_">Label</span>, director &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MenuManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./MenuManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">EnumGameStatus</span>&#123;<span class="comment">//游戏状态</span></span><br><span class="line">    init=<span class="number">1</span>,<span class="comment">//初始化</span></span><br><span class="line">    idle=<span class="number">2</span>,<span class="comment">//游玩</span></span><br><span class="line">    pause=<span class="number">3</span>,<span class="comment">//暂停</span></span><br><span class="line">    die=<span class="number">4</span>,<span class="comment">//死亡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//障碍物</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">pref_Brick</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//障碍物生成节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nd_BrickPlace</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计分板节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">lb_score</span>:<span class="title class_">Label</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//GameManager单例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="attr">instance</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计时器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Timer</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">//所有砖块</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">allBricks</span>:<span class="title class_">Node</span>[] = []</span><br><span class="line">    <span class="comment">//游戏状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_gameStatus</span>:<span class="title class_">EnumGameStatus</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//分数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_score</span>:<span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//更新、获取游戏状态</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">gameStatus</span>(<span class="params">status:EnumGameStatus</span>)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">init</span>:<span class="comment">//初始化</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:init&quot;</span>);</span><br><span class="line">                <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">init</span>();<span class="comment">//初始化的函数</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:idle&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">pause</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:pause&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:die&quot;</span>);</span><br><span class="line">                <span class="title class_">MenuManager</span>.<span class="property">instance</span>.<span class="title function_">gameEnd</span>();<span class="comment">//执行游戏结束的函数</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error:Wrong game status!&quot;</span>)</span><br><span class="line">                <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_gameStatus</span>=status;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">gameStatus</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_gameStatus</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//更新、获取游戏分数</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">score</span>(<span class="params">score:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`Score:<span class="subst">$&#123;score&#125;</span>`</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_score</span>=score;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">score</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_score</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">init</span>(<span class="params"></span>)&#123;<span class="comment">//初始化</span></span><br><span class="line">        <span class="keyword">if</span>(director.<span class="title function_">isPaused</span>())&#123;<span class="comment">//判断场景状态(是否二次加载)</span></span><br><span class="line">            director.<span class="title function_">resume</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">allBricks</span>=[];<span class="comment">//清除数组</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">removeAllChildren</span>();<span class="comment">//移除所有子节点（障碍物）</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">score</span>=<span class="number">0</span>;<span class="comment">//分数归零</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">Timer</span>=<span class="number">0</span>;<span class="comment">//计时器归零</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">scheduleOnce</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>;</span><br><span class="line">        &#125;,<span class="number">0.2</span>)<span class="comment">//延迟0.2s后切换状态</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonBricks</span>(<span class="params"></span>)&#123;<span class="comment">//生成砖块</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span> == <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>)&#123;<span class="comment">//死了就不会继续生成了</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> rand = math.<span class="title function_">randomRange</span>(-<span class="number">200</span>,<span class="number">200</span>);<span class="comment">//随机数</span></span><br><span class="line">        <span class="keyword">const</span> newBrick=<span class="title function_">instantiate</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">pref_Brick</span>);<span class="comment">//实例化</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">addChild</span>(newBrick);<span class="comment">//添加子节点</span></span><br><span class="line">        newBrick.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,rand,<span class="number">0</span>));<span class="comment">//设置节点的相对位置</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">allBricks</span>.<span class="title function_">push</span>(newBrick)<span class="comment">//入队尾</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">allBricks</span>.<span class="property">length</span>&gt;<span class="number">8</span>)&#123;<span class="comment">//判断队列长度</span></span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">allBricks</span>.<span class="title function_">shift</span>().<span class="title function_">destroy</span>()<span class="comment">//队首出队并销毁</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">tween</span>(newBrick)<span class="comment">//移动</span></span><br><span class="line">        .<span class="title function_">to</span>(<span class="number">20</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-<span class="number">2000</span>,rand,<span class="number">0</span>)&#125;)</span><br><span class="line">        .<span class="title function_">delay</span>(<span class="number">500</span>)</span><br><span class="line">        .<span class="title function_">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">checkTimer</span>(<span class="params"></span>)&#123;<span class="comment">//每一定间隔生成砖块</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">Timer</span>&lt;<span class="number">300</span>)&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">Timer</span>++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">Timer</span>=<span class="number">0</span>;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">summonBricks</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Summon&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span> = <span class="variable language_">this</span>;<span class="comment">//绑定单例</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">init</span>;<span class="comment">//初始化游戏</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">summonBricks</span>();<span class="comment">//生成第一个障碍物</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">checkTimer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BirdCtrl.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">RigidBody</span>, v3, input, <span class="title class_">Input</span>, <span class="title class_">EventMouse</span>, <span class="title class_">PhysicsSystem</span>, <span class="title class_">ICollisionEvent</span>, <span class="title class_">SphereCollider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnumGameStatus</span>, <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;BirdCtrl&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BirdCtrl</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//鸟所在的节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Bird</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">160</span>,<span class="number">320</span>,<span class="number">0</span>))<span class="comment">//设置初始位置</span></span><br><span class="line">        input.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">MOUSE_DOWN</span>,<span class="variable language_">this</span>.<span class="property">onMouseClick</span>,<span class="variable language_">this</span>);<span class="comment">//开启输入监听</span></span><br><span class="line">        <span class="title class_">PhysicsSystem</span>.<span class="property">instance</span>.<span class="property">gravity</span>=<span class="title function_">v3</span>(<span class="number">0</span>,-<span class="number">500</span>,<span class="number">0</span>);<span class="comment">//设置重力</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="property">linearDamping</span>=<span class="number">0.1</span>;<span class="comment">//设置速度阻尼</span></span><br><span class="line">        <span class="comment">//this.Bird.getComponent(Collider).on(&#x27;onTriggerEnter&#x27;,this.onHit,this)//原来的开启碰撞检测</span></span><br><span class="line">        <span class="keyword">let</span> coms=<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponents</span>(<span class="title class_">SphereCollider</span>);<span class="comment">//两个球体碰撞箱组件</span></span><br><span class="line">        coms[<span class="number">0</span>].<span class="title function_">on</span>(<span class="string">&#x27;onCollisionEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">onHit</span>,<span class="variable language_">this</span>);<span class="comment">//第一个碰撞箱，不使用触发器，对障碍物进行判断</span></span><br><span class="line">        coms[<span class="number">1</span>].<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">getScore</span>,<span class="variable language_">this</span>)<span class="comment">//第二个碰撞箱，使用触发器，对分数进行判断</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onMouseClick</span>(<span class="params">event: EventMouse</span>)&#123;<span class="comment">//鼠标输入</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="title function_">setLinearVelocity</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">300</span>,<span class="number">0</span>));<span class="comment">//更改速度为向上</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onHit</span>(<span class="params">event: ICollisionEvent</span>)&#123;<span class="comment">//撞上柱子</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hit&quot;</span>);</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span> = <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;<span class="comment">//碰撞后死亡</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getScore</span>(<span class="params">event: ICollisionEvent</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Scored&quot;</span>);</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">score</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MenuManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, director, <span class="title class_">Label</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;MenuManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MenuManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//暂停菜单</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">pauseMenu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//结算菜单</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">endMenu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计分板节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">lb_score</span>:<span class="title class_">Label</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="attr">instance</span>:<span class="title class_">MenuManager</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">MenuManager</span>.<span class="property">instance</span> = <span class="variable language_">this</span>;<span class="comment">//绑定单例</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏暂停菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">endMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏结算菜单</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">clickReplayBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//游戏重新开始</span></span><br><span class="line">        director.<span class="title function_">resume</span>()<span class="comment">//游戏场景恢复</span></span><br><span class="line">        director.<span class="title function_">loadScene</span>(<span class="title class_">CustomEventData</span>);<span class="comment">//重新载入场景</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickPauseBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//暂停游戏</span></span><br><span class="line">        director.<span class="title function_">pause</span>()<span class="comment">//游戏场景暂停</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickResumeBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//恢复游戏</span></span><br><span class="line">        director.<span class="title function_">resume</span>()<span class="comment">//游戏场景恢复</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//关闭菜单</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">changeScene</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//切换场景</span></span><br><span class="line">        director.<span class="title function_">loadScene</span>(<span class="title class_">CustomEventData</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">gameEnd</span>(<span class="params"></span>)&#123;<span class="comment">//游戏结束</span></span><br><span class="line">        director.<span class="title function_">pause</span>()<span class="comment">//游戏场景暂停</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">endMenu</span>.<span class="property">active</span> = <span class="literal">true</span>;<span class="comment">//激活节点</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`您的分数为:<span class="subst">$&#123;GameManager.instance._score&#125;</span>`</span><span class="comment">//修改文本</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="调整分辨率"><a href="#调整分辨率" class="headerlink" title="调整分辨率"></a>调整分辨率</h3><blockquote>
<p>这一段本来是开头就要写的，直到现在才想起来..调整分辨率是为了更好地适应现代的设备</p>
</blockquote>
<p>在<strong>项目-项目设置</strong>中将分辨率更改为宽1080，高1920</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220809215703258.png" alt="调整分辨率1"></p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220809215730843.png" alt="调整分辨率2"></p>
<p>由此带来的鸟儿、按钮、计分板等位置的更改还需进一步调整，这里给出一点参考：</p>
<ul>
<li>endMenu、pauseMenu宽800,高1200</li>
<li>两个菜单四个按钮2倍大小，坐标(0,±80,0)</li>
<li>两个菜单的标签1倍大小，字号80，坐标(0,500,0)</li>
<li>计分板1倍大小，字号60，坐标(0,850,0)</li>
<li>暂停按钮2倍大小坐标(-400,850,0)</li>
<li>鸟儿坐标(200,960,0)</li>
<li>BrickPlace坐标(1500,960,0)</li>
</ul>
<p>大概长这样</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220809224942404.png" alt="参考样例"></p>
<h3 id="游戏变量分离"><a href="#游戏变量分离" class="headerlink" title="游戏变量分离"></a>游戏变量分离</h3><p>为了能够更好地支持自定义属性，我们应该统一管理游戏的变量。就目前来说，游戏里的变量有：</p>
<ul>
<li>鸟儿<ul>
<li>初始高度</li>
<li>大小</li>
<li>下落加速度</li>
<li>速度阻尼（向上与向下）</li>
<li>跳跃力度</li>
</ul>
</li>
<li>障碍物<ul>
<li>生成间隔</li>
<li>移动速度</li>
<li>间距</li>
<li>宽度</li>
<li>随机高度差</li>
<li>得到的分数</li>
</ul>
</li>
</ul>
<p>新建一个类，命名为Setting，当做储存数据的模板，constructor里是默认参数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Setting</span> &#123;</span><br><span class="line">    <span class="comment">//鸟儿的初始高度</span></span><br><span class="line">    <span class="attr">birdPos</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//鸟儿的大小</span></span><br><span class="line">    <span class="attr">birdScale</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//下落加速度</span></span><br><span class="line">    <span class="attr">birdGravity</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//鸟儿向上的速度阻尼</span></span><br><span class="line">    <span class="attr">birdSpeedUpDamping</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//鸟儿向下的速度阻尼</span></span><br><span class="line">    <span class="attr">birdSpeedDownDamping</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//鸟儿跳跃力度</span></span><br><span class="line">    <span class="attr">birdJumpStrength</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//障碍物生成间隔时间</span></span><br><span class="line">    <span class="attr">brickSpawnTime</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//障碍物随机生成区间</span></span><br><span class="line">    <span class="attr">brickSpawnRand</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//障碍物移动速度</span></span><br><span class="line">    <span class="attr">brickSpeed</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//障碍物上下间距</span></span><br><span class="line">    <span class="attr">brickHeight</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//障碍物宽度</span></span><br><span class="line">    <span class="attr">brickWidth</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//越过障碍物的得分</span></span><br><span class="line">    <span class="attr">brickPoint</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        birdPos:<span class="built_in">number</span>=<span class="number">960</span>,</span></span><br><span class="line"><span class="params">        birdScale:<span class="built_in">number</span>=<span class="number">50</span>,</span></span><br><span class="line"><span class="params">        birdGravity:<span class="built_in">number</span>=<span class="number">2000</span>,</span></span><br><span class="line"><span class="params">        birdSpeedUpDamping:<span class="built_in">number</span>=<span class="number">0.6</span>,</span></span><br><span class="line"><span class="params">        birdSpeedDownDamping:<span class="built_in">number</span>=<span class="number">0</span>,</span></span><br><span class="line"><span class="params">        birdJumpStrength:<span class="built_in">number</span>=<span class="number">800</span>,</span></span><br><span class="line"><span class="params">        brickSpawnTime:<span class="built_in">number</span>=<span class="number">200</span>,</span></span><br><span class="line"><span class="params">        brickSpawnRand:<span class="built_in">number</span>=<span class="number">500</span>,</span></span><br><span class="line"><span class="params">        brickSpeed:<span class="built_in">number</span>=<span class="number">10</span>,</span></span><br><span class="line"><span class="params">        brickHeight:<span class="built_in">number</span>=<span class="number">250</span>,</span></span><br><span class="line"><span class="params">        brickWidth:<span class="built_in">number</span>=<span class="number">5</span>,</span></span><br><span class="line"><span class="params">        brickPoint:<span class="built_in">number</span>=<span class="number">1</span>,</span></span><br><span class="line"><span class="params">        </span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">birdPos</span> = birdPos;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">birdScale</span> = birdScale;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">birdGravity</span> = birdGravity;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">birdSpeedUpDamping</span> = birdSpeedUpDamping;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">birdSpeedDownDamping</span> = birdSpeedDownDamping;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">birdJumpStrength</span> = birdJumpStrength;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">brickSpawnTime</span> = brickSpawnTime;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">brickSpawnRand</span> = brickSpawnRand;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">brickSpeed</span> = brickSpeed;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">brickHeight</span> = brickHeight;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">brickWidth</span> = brickWidth;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">brickPoint</span> = brickPoint;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时，我们需要一个脚本实现数据的统一存储与分发</p>
<p>新建一个脚本，命名为GameData，内容如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameData.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, sys &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Setting</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Setting&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property,executionOrder &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameData&#x27;</span>)</span><br><span class="line"><span class="meta">@executionOrder</span>(-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameData</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> data = <span class="keyword">new</span> <span class="title class_">Setting</span>();</span><br><span class="line">    <span class="title function_">getData</span>(<span class="params"></span>)&#123;<span class="comment">//获取数据</span></span><br><span class="line">        <span class="keyword">if</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;gameValue&quot;</span>) === <span class="literal">null</span>)&#123;<span class="comment">//如果没有数据，则传入默认设置</span></span><br><span class="line">            sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;gameValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="title class_">GameData</span>.<span class="property">data</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameData</span>.<span class="property">data</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;gameValue&quot;</span>))<span class="comment">//获取浏览器缓存设置</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> x <span class="keyword">in</span> <span class="title class_">GameData</span>.<span class="property">data</span>)&#123;<span class="comment">//把取得的数据转为整数</span></span><br><span class="line">            <span class="title class_">GameData</span>.<span class="property">data</span>[x] = <span class="built_in">parseFloat</span>(<span class="title class_">GameData</span>.<span class="property">data</span>[x]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getData</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于这个脚本是为其他所有脚本提供数据支持，所以必须在其他脚本之前加载，这里用到了@executionOrder装饰器，其值越小越先加载，默认是0</p>
</blockquote>
<blockquote>
<p>sys.localStorage用于向浏览器存取数据，内容必须是JSON</p>
</blockquote>
<p>然后我们就需要在GameManager，BirdCtrl里应用这些变量了，由于更改位置过多，这里只贴出最终代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BirdCtrl.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">RigidBody</span>, v3, input, <span class="title class_">Input</span>, <span class="title class_">EventMouse</span>, <span class="title class_">PhysicsSystem</span>, <span class="title class_">ICollisionEvent</span>, <span class="title class_">SphereCollider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnumGameStatus</span>, <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameData</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameData&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;BirdCtrl&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BirdCtrl</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//鸟所在的节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Bird</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//刚体组件，提前加载并缓存以减轻游戏性能开销，提升优化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">RigidBodyComPonent</span>:<span class="title class_">RigidBody</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span> = <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">checkPos</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">changeDamping</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">200</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdPos</span>,<span class="number">0</span>))<span class="comment">//设置初始位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">setScale</span>(<span class="title function_">v3</span>(<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdScale</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdScale</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdScale</span>))<span class="comment">//设置体型大小</span></span><br><span class="line">        input.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">MOUSE_DOWN</span>,<span class="variable language_">this</span>.<span class="property">onMouseClick</span>,<span class="variable language_">this</span>);<span class="comment">//开启输入监听</span></span><br><span class="line">        <span class="title class_">PhysicsSystem</span>.<span class="property">instance</span>.<span class="property">gravity</span>=<span class="title function_">v3</span>(<span class="number">0</span>,-<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdGravity</span>,<span class="number">0</span>);<span class="comment">//设置重力</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="property">linearDamping</span>=<span class="number">0</span>;<span class="comment">//设置速度阻尼</span></span><br><span class="line">        <span class="comment">//this.Bird.getComponent(Collider).on(&#x27;onTriggerEnter&#x27;,this.onHit,this)//原来的开启碰撞检测</span></span><br><span class="line">        <span class="keyword">let</span> coms=<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponents</span>(<span class="title class_">SphereCollider</span>);<span class="comment">//两个球体碰撞箱组件</span></span><br><span class="line">        coms[<span class="number">0</span>].<span class="title function_">on</span>(<span class="string">&#x27;onCollisionEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">onHit</span>,<span class="variable language_">this</span>);<span class="comment">//第一个碰撞箱，不使用触发器，对障碍物进行判断</span></span><br><span class="line">        coms[<span class="number">1</span>].<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">getScore</span>,<span class="variable language_">this</span>)<span class="comment">//第二个碰撞箱，使用触发器，对分数进行判断</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onMouseClick</span>(<span class="params">event: EventMouse</span>)&#123;<span class="comment">//鼠标输入</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="title function_">setLinearVelocity</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdJumpStrength</span>,<span class="number">0</span>));<span class="comment">//更改速度为向上</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onHit</span>(<span class="params">event: ICollisionEvent</span>)&#123;<span class="comment">//撞上柱子</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hit&quot;</span>);</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span> = <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;<span class="comment">//碰撞后死亡</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getScore</span>(<span class="params">event: ICollisionEvent</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Scored&quot;</span>);</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">score</span>+=<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickPoint</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">changeDamping</span>(<span class="params"></span>)&#123;<span class="comment">//切换速度阻尼，向上阻尼大，向下阻尼小</span></span><br><span class="line">        <span class="keyword">let</span> speed = <span class="title function_">v3</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="title function_">getLinearVelocity</span>(speed);</span><br><span class="line">        <span class="keyword">if</span>(speed.<span class="property">y</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="property">linearDamping</span> = <span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdSpeedUpDamping</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="property">linearDamping</span> = <span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdSpeedDownDamping</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">checkPos</span>(<span class="params"></span>)&#123;<span class="comment">//检查鸟儿位置，离开屏幕判定为死亡</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="property">position</span>.<span class="property">y</span>&lt;<span class="number">0</span>||<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="property">position</span>.<span class="property">y</span>&gt;<span class="number">1920</span>)&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span> = <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, math, v3, instantiate, tween, <span class="title class_">Label</span>, director, macro &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameData</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameData&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MenuManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./MenuManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">EnumGameStatus</span>&#123;<span class="comment">//游戏状态</span></span><br><span class="line">    init=<span class="number">1</span>,<span class="comment">//初始化</span></span><br><span class="line">    idle=<span class="number">2</span>,<span class="comment">//游玩</span></span><br><span class="line">    pause=<span class="number">3</span>,<span class="comment">//暂停</span></span><br><span class="line">    die=<span class="number">4</span>,<span class="comment">//死亡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//障碍物</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">pref_Brick</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//障碍物生成节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nd_BrickPlace</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计分板节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">lb_score</span>:<span class="title class_">Label</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//GameManager单例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="attr">instance</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计时器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Timer</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">//所有砖块</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">allBricks</span>:<span class="title class_">Node</span>[] = []</span><br><span class="line">    <span class="comment">//游戏状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_gameStatus</span>:<span class="title class_">EnumGameStatus</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//分数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_score</span>:<span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//更新、获取游戏状态</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">gameStatus</span>(<span class="params">status:EnumGameStatus</span>)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">init</span>:<span class="comment">//初始化</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:init&quot;</span>);</span><br><span class="line">                <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">init</span>();<span class="comment">//初始化的函数</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:idle&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">pause</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:pause&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:die&quot;</span>);</span><br><span class="line">                <span class="title class_">MenuManager</span>.<span class="property">instance</span>.<span class="title function_">gameEnd</span>();<span class="comment">//执行游戏结束的函数</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error:Wrong game status!&quot;</span>)</span><br><span class="line">                <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_gameStatus</span>=status;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">gameStatus</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_gameStatus</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//更新、获取游戏分数</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">score</span>(<span class="params">score:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`Score:<span class="subst">$&#123;score&#125;</span>`</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_score</span>=score;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">score</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_score</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">init</span>(<span class="params"></span>)&#123;<span class="comment">//初始化</span></span><br><span class="line">        <span class="keyword">if</span>(director.<span class="title function_">isPaused</span>())&#123;<span class="comment">//判断场景状态(是否二次加载)</span></span><br><span class="line">            director.<span class="title function_">resume</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">allBricks</span>=[];<span class="comment">//清除数组</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">removeAllChildren</span>();<span class="comment">//移除所有子节点（障碍物）</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">score</span>=<span class="number">0</span>;<span class="comment">//分数归零</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">Timer</span>=<span class="number">0</span>;<span class="comment">//计时器归零</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">scheduleOnce</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>;</span><br><span class="line">        &#125;,<span class="number">0.2</span>)<span class="comment">//延迟0.2s后切换状态</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonBricks</span>(<span class="params"></span>)&#123;<span class="comment">//生成砖块</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span> == <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>)&#123;<span class="comment">//死了就不会继续生成了</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> rand = math.<span class="title function_">randomRange</span>(-<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpawnRand</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpawnRand</span>);<span class="comment">//随机数</span></span><br><span class="line">        <span class="keyword">const</span> newBrick=<span class="title function_">instantiate</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">pref_Brick</span>);<span class="comment">//实例化</span></span><br><span class="line">        &#123;<span class="comment">//自定义部分</span></span><br><span class="line">            <span class="keyword">let</span> up = newBrick.<span class="title function_">getChildByName</span>(<span class="string">&quot;Up&quot;</span>)<span class="comment">//障碍物的上半部分</span></span><br><span class="line">            <span class="keyword">let</span> down = newBrick.<span class="title function_">getChildByName</span>(<span class="string">&quot;Down&quot;</span>)<span class="comment">//障碍物的下半部分</span></span><br><span class="line">            <span class="keyword">let</span> score = newBrick.<span class="title function_">getChildByName</span>(<span class="string">&quot;Score&quot;</span>)<span class="comment">//障碍物的得分检测碰撞箱</span></span><br><span class="line">            <span class="keyword">let</span> pos = <span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickHeight</span>/<span class="number">2</span>+<span class="number">2000</span>;</span><br><span class="line">            <span class="keyword">let</span> scale = <span class="number">30</span>*<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickWidth</span></span><br><span class="line">            up.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,pos,<span class="number">0</span>));</span><br><span class="line">            down.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,-pos,<span class="number">0</span>));</span><br><span class="line">            up.<span class="title function_">setScale</span>(<span class="title function_">v3</span>(scale,<span class="number">2000</span>,<span class="number">30</span>));</span><br><span class="line">            down.<span class="title function_">setScale</span>(<span class="title function_">v3</span>(scale,<span class="number">2000</span>,<span class="number">30</span>));</span><br><span class="line">            score.<span class="title function_">setScale</span>(<span class="title function_">v3</span>(<span class="number">1</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickHeight</span>,<span class="number">30</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">addChild</span>(newBrick);<span class="comment">//添加子节点</span></span><br><span class="line">        newBrick.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,rand,<span class="number">0</span>));<span class="comment">//设置节点的相对位置</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">allBricks</span>.<span class="title function_">push</span>(newBrick)<span class="comment">//入队尾</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">allBricks</span>.<span class="property">length</span>&gt;<span class="number">8</span>)&#123;<span class="comment">//判断队列长度</span></span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">allBricks</span>.<span class="title function_">shift</span>().<span class="title function_">destroy</span>()<span class="comment">//队首出队并销毁</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">tween</span>(newBrick)<span class="comment">//移动</span></span><br><span class="line">        .<span class="title function_">to</span>(<span class="number">10</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-(<span class="number">1500</span>+<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpeed</span>*<span class="number">100</span>),rand,<span class="number">0</span>)&#125;)</span><br><span class="line">        .<span class="title function_">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">checkTimer</span>(<span class="params"></span>)&#123;<span class="comment">//每一定间隔生成砖块</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">Timer</span>&lt;<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpawnTime</span>)&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">Timer</span>++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">Timer</span>=<span class="number">0</span>;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">summonBricks</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Summon&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span> = <span class="variable language_">this</span>;<span class="comment">//绑定单例</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">init</span>;<span class="comment">//初始化游戏</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">summonBricks</span>();<span class="comment">//生成第一个障碍物</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">checkTimer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>MenuManager无变化，这里略</li>
</ul>
<p>这里可以保存测试一下，确保游戏运行正常（记得应用节点）</p>
<h3 id="游戏内容自定义"><a href="#游戏内容自定义" class="headerlink" title="游戏内容自定义"></a>游戏内容自定义</h3><p>要让游戏保持一定的活力与可重复游玩价值，一点自定义内容是必不可少的，这里我们来实现一个简单的设置菜单</p>
<p>新建一个脚本，命名为SettingManager，他用来修改游戏的部分参数并储存到浏览器缓存中供GameData脚本读取</p>
<p>接着，在场景里组合一个菜单，以及添加一个按钮用于指向菜单，大概长这样</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220810130524644.png" alt="节点树"></p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220810130654129.png" alt="设置菜单(不包含摄像机)"></p>
<ul>
<li>这里会用到UI组件里的滑动器Slider</li>
</ul>
<p>打开SettingManager脚本，首先在类内声明几个变量，作用如下所示</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//菜单节点</span></span><br><span class="line"><span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line"><span class="title class_">Menu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">//未保存提示的节点</span></span><br><span class="line"><span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line"><span class="title class_">Warning</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">//设置模板，带默认参数</span></span><br><span class="line"><span class="keyword">private</span> localSetting = <span class="keyword">new</span> <span class="title class_">Setting</span>();</span><br><span class="line"><span class="comment">//保存指示器</span></span><br><span class="line"><span class="keyword">private</span> isSaved = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//菜单里的设置的根节点，用于后续查找</span></span><br><span class="line"><span class="keyword">private</span> <span class="attr">nodeArray</span>:<span class="title class_">Node</span>[][];</span><br><span class="line"><span class="comment">//设置选项的字符串表，用于查找顺序</span></span><br><span class="line"><span class="keyword">private</span>  stringOfSetting = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="string">&quot;birdPos&quot;</span>,<span class="string">&quot;birdScale&quot;</span>,<span class="string">&quot;birdGravity&quot;</span>,<span class="string">&quot;birdSpeedUpDamping&quot;</span>,<span class="string">&quot;birdSpeedDownDamping&quot;</span>,<span class="string">&quot;birdJumpStrength&quot;</span>,<span class="string">&quot;brickSpawnTime&quot;</span>,<span class="string">&quot;brickSpawnRand&quot;</span>,<span class="string">&quot;brickSpeed&quot;</span>,<span class="string">&quot;brickHeight&quot;</span>,<span class="string">&quot;brickWidth&quot;</span>,<span class="string">&quot;brickPoint&quot;</span>)</span><br><span class="line"><span class="comment">//滑条百分比的数据</span></span><br><span class="line"><span class="keyword">private</span> sliderData = <span class="keyword">new</span> <span class="title class_">Setting</span>(<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>由于有函数会在你每一次移动滑动器的时候触发一次，我打算一次性获取到菜单里所有节点缓存下来以减小性能开销，所以我们还需要两个枚举来加以标识（这个记得写在类外）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">EnumSettingType</span>&#123;<span class="comment">//枚举设置类型，便于后续数组操作</span></span><br><span class="line">    birdPos=<span class="number">0</span>,</span><br><span class="line">    birdScale=<span class="number">1</span>,</span><br><span class="line">    birdGravity=<span class="number">2</span>,</span><br><span class="line">    birdSpeedUpDamping=<span class="number">3</span>,</span><br><span class="line">    birdSpeedDownDamping=<span class="number">4</span>,</span><br><span class="line">    birdJumpStrength=<span class="number">5</span>,</span><br><span class="line">    brickSpawnTime=<span class="number">6</span>,</span><br><span class="line">    brickSpawnRand=<span class="number">7</span>,</span><br><span class="line">    brickSpeed=<span class="number">8</span>,</span><br><span class="line">    brickHeight=<span class="number">9</span>,</span><br><span class="line">    brickWidth=<span class="number">10</span>,</span><br><span class="line">    brickPoint=<span class="number">11</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">EnumNodeType</span>&#123;<span class="comment">//枚举节点类型，便于后续数组操作</span></span><br><span class="line">    lb_description=<span class="number">0</span>,</span><br><span class="line">    slider=<span class="number">1</span>,</span><br><span class="line">    lb_value=<span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再写一个函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getNodeArray</span>(<span class="params"></span>)&#123;<span class="comment">//获取设置里的所有节点，便于后续操作</span></span><br><span class="line">    <span class="keyword">let</span> rootNodeChildren = <span class="title function_">find</span>(<span class="string">&#x27;Canvas/Setting/Sliders&#x27;</span>).<span class="property">children</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">nodeArray</span> = <span class="keyword">new</span> <span class="title class_">Array</span>(rootNodeChildren.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;rootNodeChildren.<span class="property">length</span>;i++)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nodeArray</span>[i] = <span class="keyword">new</span> <span class="title class_">Array</span>(rootNodeChildren[<span class="number">0</span>].<span class="property">children</span>.<span class="property">length</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nodeArray</span>[i] = rootNodeChildren[i].<span class="property">children</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有就是GameData里的同款getData</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getData</span>(<span class="params"></span>)&#123;<span class="comment">//从浏览器获取缓存数据</span></span><br><span class="line">    <span class="keyword">if</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;gameValue&quot;</span>) === <span class="literal">null</span>||sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;sliderValue&quot;</span>) === <span class="literal">null</span>)&#123;<span class="comment">//没有设置就传入默认设置</span></span><br><span class="line">        sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;gameValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">localSetting</span>))</span><br><span class="line">        sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;sliderValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">sliderData</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">localSetting</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;gameValue&quot;</span>))<span class="comment">//获取浏览器缓存设置</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sliderData</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;sliderValue&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着，为菜单里的按钮写一些实现函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">clickApplyBtn</span>(<span class="params"></span>)&#123;<span class="comment">//点击应用按钮</span></span><br><span class="line">    sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;gameValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">localSetting</span>));<span class="comment">//储存本地设置至浏览器缓存</span></span><br><span class="line">    sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;sliderValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">sliderData</span>));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isSaved</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">clickSettingBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//点击设置按钮</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getData</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Menu</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="variable language_">this</span>.<span class="property">nodeArray</span>.<span class="property">length</span>;i++)&#123;<span class="comment">//为滑动器和旁边的数字标签应用数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nodeArray</span>[i][<span class="title class_">EnumNodeType</span>.<span class="property">slider</span>].<span class="title function_">getComponent</span>(<span class="title class_">Slider</span>).<span class="property">progress</span> = <span class="variable language_">this</span>.<span class="property">sliderData</span>[<span class="variable language_">this</span>.<span class="property">stringOfSetting</span>[i]];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nodeArray</span>[i][<span class="title class_">EnumNodeType</span>.<span class="property">lb_value</span>].<span class="title function_">getComponent</span>(<span class="title class_">Label</span>).<span class="property">string</span> = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.localSetting[<span class="variable language_">this</span>.stringOfSetting[i]]&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">clickReturnBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//点击返回按钮</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">isSaved</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Menu</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Warning</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isSaved</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Warning</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以及别忘了在脚本加载的时候调用这些函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onLoad</span>(<span class="params"></span>)&#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Menu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//设置菜单，初始关闭</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Warning</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//未保存提示，初始关闭</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getNodeArray</span>();<span class="comment">//获取节点数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，也是这个脚本的核心，就是让这些滑动器发挥作用，请不要小看这简单的滑块，他至少应该做到以下几点：</p>
<ul>
<li>滑动的时候能修改Setting类里的数值</li>
<li>滑动的时候能改变旁边那个标签的内容</li>
<li>打开菜单的时候能读取Setting的内容并移动到对应位置</li>
</ul>
<p>代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">changeSetting</span>(<span class="params">event:Event,CustomEventData</span>)&#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isSaved</span> = <span class="literal">false</span>;<span class="comment">//保存指示器置否，表示未保存状态</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Warning</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//关闭提示标签</span></span><br><span class="line">    <span class="title class_">CustomEventData</span> = <span class="built_in">parseInt</span>(<span class="title class_">CustomEventData</span>);<span class="comment">//传入是字符串，转成整数</span></span><br><span class="line">    <span class="keyword">let</span> value,progress;</span><br><span class="line">    progress = <span class="variable language_">this</span>.<span class="property">nodeArray</span>[<span class="title class_">CustomEventData</span>][<span class="title class_">EnumNodeType</span>.<span class="property">slider</span>].<span class="title function_">getComponent</span>(<span class="title class_">Slider</span>).<span class="property">progress</span>.<span class="title function_">toFixed</span>(<span class="number">2</span>);<span class="comment">//滑动器的百分比</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(<span class="title class_">CustomEventData</span>)&#123;<span class="comment">//各个设置对应的参数算法</span></span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdPos</span>:</span><br><span class="line">            value = (<span class="number">1920</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdScale</span>:</span><br><span class="line">            value = (<span class="number">10</span>+<span class="number">80</span>*progress).<span class="title function_">toFixed</span>(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdGravity</span>:</span><br><span class="line">            value = (<span class="number">4000</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdSpeedUpDamping</span>:</span><br><span class="line">            value = (<span class="number">0.8</span>*progress).<span class="title function_">toFixed</span>(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdSpeedDownDamping</span>:</span><br><span class="line">            value = (<span class="number">0.8</span>*progress).<span class="title function_">toFixed</span>(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdJumpStrength</span>:</span><br><span class="line">            value = (<span class="number">1600</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickSpawnTime</span>:</span><br><span class="line">            value = (<span class="number">400</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickSpawnRand</span>:</span><br><span class="line">            value = (<span class="number">1000</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickSpeed</span>:</span><br><span class="line">            value = (<span class="number">5</span>+<span class="number">10</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickHeight</span>:</span><br><span class="line">            value = (<span class="number">50</span>+<span class="number">400</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickWidth</span>:</span><br><span class="line">            value = (<span class="number">1</span>+<span class="number">8</span>*progress).<span class="title function_">toFixed</span>(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickPoint</span>:</span><br><span class="line">            value = (<span class="number">1</span>+<span class="number">2</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">localSetting</span>[<span class="variable language_">this</span>.<span class="property">stringOfSetting</span>[<span class="title class_">CustomEventData</span>]] = value;<span class="comment">//修改本地设置</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sliderData</span>[<span class="variable language_">this</span>.<span class="property">stringOfSetting</span>[<span class="title class_">CustomEventData</span>]] = progress;<span class="comment">//修改本地滑动器设置</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">nodeArray</span>[<span class="title class_">CustomEventData</span>][<span class="title class_">EnumNodeType</span>.<span class="property">lb_value</span>].<span class="title function_">getComponent</span>(<span class="title class_">Label</span>).<span class="property">string</span> = <span class="string">`<span class="subst">$&#123;value&#125;</span>`</span><span class="comment">//修改数字标签内容</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在编辑器里依次给每个滑动器设置Slide Events，CustomEventData的内容为他们的编号0~13，可以参考上面的枚举，以及设置按钮的Click Events和SettingManager的节点</p>
<p>最终代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SettingManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, sys, find, <span class="title class_">Slider</span>, <span class="title class_">Label</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Setting</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Setting&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">EnumSettingType</span>&#123;<span class="comment">//枚举设置类型，便于后续数组操作</span></span><br><span class="line">    birdPos=<span class="number">0</span>,</span><br><span class="line">    birdScale=<span class="number">1</span>,</span><br><span class="line">    birdGravity=<span class="number">2</span>,</span><br><span class="line">    birdSpeedUpDamping=<span class="number">3</span>,</span><br><span class="line">    birdSpeedDownDamping=<span class="number">4</span>,</span><br><span class="line">    birdJumpStrength=<span class="number">5</span>,</span><br><span class="line">    brickSpawnTime=<span class="number">6</span>,</span><br><span class="line">    brickSpawnRand=<span class="number">7</span>,</span><br><span class="line">    brickSpeed=<span class="number">8</span>,</span><br><span class="line">    brickHeight=<span class="number">9</span>,</span><br><span class="line">    brickWidth=<span class="number">10</span>,</span><br><span class="line">    brickPoint=<span class="number">11</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">EnumNodeType</span>&#123;<span class="comment">//枚举节点类型，便于后续数组操作</span></span><br><span class="line">    lb_description=<span class="number">0</span>,</span><br><span class="line">    slider=<span class="number">1</span>,</span><br><span class="line">    lb_value=<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;SettingManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">SettingManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//菜单节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Menu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//未保存提示的节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Warning</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//设置模板，带默认参数</span></span><br><span class="line">    <span class="keyword">private</span> localSetting = <span class="keyword">new</span> <span class="title class_">Setting</span>();</span><br><span class="line">    <span class="comment">//保存指示器</span></span><br><span class="line">    <span class="keyword">private</span> isSaved = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//菜单里的设置的根节点，用于后续查找</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nodeArray</span>:<span class="title class_">Node</span>[][];</span><br><span class="line">    <span class="comment">//设置选项的字符串表，用于查找顺序</span></span><br><span class="line">    <span class="keyword">private</span>  stringOfSetting = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="string">&quot;birdPos&quot;</span>,<span class="string">&quot;birdScale&quot;</span>,<span class="string">&quot;birdGravity&quot;</span>,<span class="string">&quot;birdSpeedUpDamping&quot;</span>,<span class="string">&quot;birdSpeedDownDamping&quot;</span>,<span class="string">&quot;birdJumpStrength&quot;</span>,<span class="string">&quot;brickSpawnTime&quot;</span>,<span class="string">&quot;brickSpawnRand&quot;</span>,<span class="string">&quot;brickSpeed&quot;</span>,<span class="string">&quot;brickHeight&quot;</span>,<span class="string">&quot;brickWidth&quot;</span>,<span class="string">&quot;brickPoint&quot;</span>)</span><br><span class="line">    <span class="comment">//滑条百分比的数据</span></span><br><span class="line">    <span class="keyword">private</span> sliderData = <span class="keyword">new</span> <span class="title class_">Setting</span>(<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">clickApplyBtn</span>(<span class="params"></span>)&#123;<span class="comment">//点击应用按钮</span></span><br><span class="line">        sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;gameValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">localSetting</span>));<span class="comment">//储存本地设置至浏览器缓存</span></span><br><span class="line">        sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;sliderValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">sliderData</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isSaved</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickSettingBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//点击设置按钮</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getData</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Menu</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="variable language_">this</span>.<span class="property">nodeArray</span>.<span class="property">length</span>;i++)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">nodeArray</span>[i][<span class="title class_">EnumNodeType</span>.<span class="property">slider</span>].<span class="title function_">getComponent</span>(<span class="title class_">Slider</span>).<span class="property">progress</span> = <span class="variable language_">this</span>.<span class="property">sliderData</span>[<span class="variable language_">this</span>.<span class="property">stringOfSetting</span>[i]];</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">nodeArray</span>[i][<span class="title class_">EnumNodeType</span>.<span class="property">lb_value</span>].<span class="title function_">getComponent</span>(<span class="title class_">Label</span>).<span class="property">string</span> = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.localSetting[<span class="variable language_">this</span>.stringOfSetting[i]]&#125;</span>`</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickReturnBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//点击返回按钮</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">isSaved</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Menu</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Warning</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isSaved</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Warning</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;     </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getData</span>(<span class="params"></span>)&#123;<span class="comment">//从浏览器获取缓存数据</span></span><br><span class="line">        <span class="keyword">if</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;gameValue&quot;</span>) === <span class="literal">null</span>||sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;sliderValue&quot;</span>) === <span class="literal">null</span>)&#123;<span class="comment">//传入默认设置</span></span><br><span class="line">            sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;gameValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">localSetting</span>))</span><br><span class="line">            sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;sliderValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">sliderData</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">localSetting</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;gameValue&quot;</span>))<span class="comment">//获取浏览器缓存设置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sliderData</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;sliderValue&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getNodeArray</span>(<span class="params"></span>)&#123;<span class="comment">//获取设置的所有节点，便于后续操作</span></span><br><span class="line">        <span class="keyword">let</span> rootNodeChildren = <span class="title function_">find</span>(<span class="string">&#x27;Canvas/Setting/Sliders&#x27;</span>).<span class="property">children</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nodeArray</span> = <span class="keyword">new</span> <span class="title class_">Array</span>(rootNodeChildren.<span class="property">length</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;rootNodeChildren.<span class="property">length</span>;i++)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">nodeArray</span>[i] = <span class="keyword">new</span> <span class="title class_">Array</span>(rootNodeChildren[<span class="number">0</span>].<span class="property">children</span>.<span class="property">length</span>)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">nodeArray</span>[i] = rootNodeChildren[i].<span class="property">children</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">changeSetting</span>(<span class="params">event:Event,CustomEventData</span>)&#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isSaved</span> = <span class="literal">false</span>;<span class="comment">//保存指示器置否，表示未保存状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Warning</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//关闭提示标签</span></span><br><span class="line">        <span class="title class_">CustomEventData</span> = <span class="built_in">parseInt</span>(<span class="title class_">CustomEventData</span>);<span class="comment">//传入是字符串，转成整数</span></span><br><span class="line">        <span class="keyword">let</span> value,progress;</span><br><span class="line">        progress = <span class="variable language_">this</span>.<span class="property">nodeArray</span>[<span class="title class_">CustomEventData</span>][<span class="title class_">EnumNodeType</span>.<span class="property">slider</span>].<span class="title function_">getComponent</span>(<span class="title class_">Slider</span>).<span class="property">progress</span>.<span class="title function_">toFixed</span>(<span class="number">2</span>);<span class="comment">//滑动器的百分比</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span>(<span class="title class_">CustomEventData</span>)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdPos</span>:</span><br><span class="line">                value = (<span class="number">1920</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdScale</span>:</span><br><span class="line">                value = (<span class="number">10</span>+<span class="number">80</span>*progress).<span class="title function_">toFixed</span>(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdGravity</span>:</span><br><span class="line">                value = (<span class="number">4000</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdSpeedUpDamping</span>:</span><br><span class="line">                value = (<span class="number">0.8</span>*progress).<span class="title function_">toFixed</span>(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdSpeedDownDamping</span>:</span><br><span class="line">                value = (<span class="number">0.8</span>*progress).<span class="title function_">toFixed</span>(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdJumpStrength</span>:</span><br><span class="line">                value = (<span class="number">1600</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickSpawnTime</span>:</span><br><span class="line">                value = (<span class="number">400</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickSpawnRand</span>:</span><br><span class="line">                value = (<span class="number">1000</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickSpeed</span>:</span><br><span class="line">                value = (<span class="number">5</span>+<span class="number">10</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickHeight</span>:</span><br><span class="line">                value = (<span class="number">50</span>+<span class="number">400</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickWidth</span>:</span><br><span class="line">                value = (<span class="number">1</span>+<span class="number">8</span>*progress).<span class="title function_">toFixed</span>(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickPoint</span>:</span><br><span class="line">                value = (<span class="number">1</span>+<span class="number">2</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">localSetting</span>[<span class="variable language_">this</span>.<span class="property">stringOfSetting</span>[<span class="title class_">CustomEventData</span>]] = value;<span class="comment">//修改本地设置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sliderData</span>[<span class="variable language_">this</span>.<span class="property">stringOfSetting</span>[<span class="title class_">CustomEventData</span>]] = progress;<span class="comment">//修改本地滑动器设置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nodeArray</span>[<span class="title class_">CustomEventData</span>][<span class="title class_">EnumNodeType</span>.<span class="property">lb_value</span>].<span class="title function_">getComponent</span>(<span class="title class_">Label</span>).<span class="property">string</span> = <span class="string">`<span class="subst">$&#123;value&#125;</span>`</span><span class="comment">//修改数字标签内容</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Menu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//设置菜单，初始关闭</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Warning</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//未保存提示，初始关闭</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getNodeArray</span>();<span class="comment">//获取节点数据</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="游戏场景美化"><a href="#游戏场景美化" class="headerlink" title="游戏场景美化"></a>游戏场景美化</h3><p>游戏底层逻辑完成以后，就可以思考美术的事情了。对于这个游戏，我们可以在这几个地方下功夫：</p>
<ol>
<li>背景</li>
<li>障碍物</li>
<li>鸟儿</li>
<li>菜单、按钮</li>
<li>计分板</li>
</ol>
<p>鉴于笔者的美术能力，这里我选择在网络上寻找资源，因此我在这里放一份方便读者取用。<a href="/resources/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/assets.zip">点此下载</a></p>
<h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>背景简而言之就是让一块贴图周期性地产生、移动并消失。在texture文件里点击land和bg_day，把他们的类型转换为sprite-frame，目的是把它们转换成精灵(sprite)后应用到编辑器里的各个地方。之后background的prefab应该就能正常显示了</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220820102237378.png" alt="调整图片类型"></p>
<p>与生成障碍物类似，我们需要在Canvas节点下新建一个节点，命名为backgroundPlace，作为背景生成的地方，坐标为(1080,0,0)。除此之外，为了能让这个预制件被渲染出来，这里使用了Main Camera（之前闲置的那个）摄像机，把他的参数调整至下图所示即可</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220820203522340.png" alt="主摄像机参数"></p>
<p>然后在GameManager里声明两个资产变量，分别是一个类型为Prefab的变量pref_Background，用于指向这个背景；以及一个类型为Node的变量nd_BackgroundPlace，用于指向背景的生成点。再写个函数，使用tween缓动实例让他动起来。</p>
<p>对于第一个生成的背景，鉴于他一开始出生在画面中央，我这里选择为他写一个额外的函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//背景</span></span><br><span class="line"><span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line"><span class="keyword">private</span> <span class="attr">pref_Background</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line"><span class="comment">//背景生成节点</span></span><br><span class="line"><span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line"><span class="keyword">private</span> <span class="attr">nd_BackgroundPlace</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">summonBackground</span>(<span class="params"></span>)&#123;<span class="comment">//生成背景</span></span><br><span class="line">    <span class="keyword">const</span> newBackground = <span class="title function_">instantiate</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">pref_Background</span>);</span><br><span class="line">    <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BackgroundPlace</span>.<span class="title function_">addChild</span>(newBackground);</span><br><span class="line">    newBackground.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    <span class="title function_">tween</span>(newBackground)</span><br><span class="line">        .<span class="title function_">to</span>(<span class="number">10</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-<span class="number">2160</span>,<span class="number">0</span>,<span class="number">0</span>)&#125;)<span class="comment">//从屏幕右边移动到屏幕左边</span></span><br><span class="line">        .<span class="title function_">call</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        newBackground.<span class="title function_">destroy</span>();<span class="comment">//使用回调函数清除</span></span><br><span class="line">    &#125;)</span><br><span class="line">        .<span class="title function_">start</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="title function_">summonFirstBackground</span>(<span class="params"></span>)&#123;<span class="comment">//生成第一个背景</span></span><br><span class="line">    <span class="keyword">const</span> newBackground = <span class="title function_">instantiate</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">pref_Background</span>);</span><br><span class="line">    <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BackgroundPlace</span>.<span class="title function_">addChild</span>(newBackground);</span><br><span class="line">    newBackground.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(-<span class="number">1080</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    <span class="title function_">tween</span>(newBackground)</span><br><span class="line">        .<span class="title function_">to</span>(<span class="number">10</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-<span class="number">3240</span>,<span class="number">0</span>,<span class="number">0</span>)&#125;)<span class="comment">//从屏幕中间移动到屏幕左边</span></span><br><span class="line">        .<span class="title function_">call</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        newBackground.<span class="title function_">destroy</span>();<span class="comment">//使用回调函数清除</span></span><br><span class="line">    &#125;)</span><br><span class="line">        .<span class="title function_">start</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了让他看起来就像连续不断的卷轴一样，我们需要周期性生成这个背景，这里使用一个全局<strong>计时器scheduler</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">start</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">scheduler</span>:<span class="title class_">Scheduler</span> = director.<span class="title function_">getScheduler</span>();</span><br><span class="line">    scheduler.<span class="title function_">schedule</span>(<span class="variable language_">this</span>.<span class="property">summonBackground</span>,<span class="variable language_">this</span>,<span class="number">5</span>,macro.<span class="property">REPEAT_FOREVER</span>,<span class="number">0</span>,<span class="literal">false</span>);<span class="comment">//周期性生成背景</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>director.getScheduler()用于获取全局的计时器，然后可以通过schedule方法添加一个计时器，第一个参数是回调函数，第二个参数是触发对象，一般是this，第三个参数是重复次数，这里是<strong>macro宏定义</strong>下的无限循环，第四个参数是延迟时间，第五个参数是初始是否暂停</p>
</blockquote>
<p>同时，别忘了在init函数里调用summonFirstBackground，并且像清除障碍物一样清除backgroundPlace里的子节点</p>
<p>最后，在编辑器里应用节点并保存测试，如果能看到连贯的背景移动就算成功</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-9.gif" alt="移动的背景"></p>
<p>目前代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, math, v3, instantiate, tween, <span class="title class_">Label</span>, director, macro, <span class="title class_">Scheduler</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameData</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameData&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MenuManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./MenuManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">EnumGameStatus</span>&#123;<span class="comment">//游戏状态</span></span><br><span class="line">    init=<span class="number">1</span>,<span class="comment">//初始化</span></span><br><span class="line">    idle=<span class="number">2</span>,<span class="comment">//游玩</span></span><br><span class="line">    pause=<span class="number">3</span>,<span class="comment">//暂停</span></span><br><span class="line">    die=<span class="number">4</span>,<span class="comment">//死亡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//障碍物</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">pref_Brick</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//背景</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">pref_Background</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//障碍物生成节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nd_BrickPlace</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//背景生成节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nd_BackgroundPlace</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计分板节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">lb_score</span>:<span class="title class_">Label</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line">    <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//GameManager单例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="attr">instance</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计时器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Timer</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">//所有砖块</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">allBricks</span>:<span class="title class_">Node</span>[] = []</span><br><span class="line">    <span class="comment">//游戏状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_gameStatus</span>:<span class="title class_">EnumGameStatus</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//分数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_score</span>:<span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//更新、获取游戏状态</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">gameStatus</span>(<span class="params">status:EnumGameStatus</span>)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">init</span>:<span class="comment">//初始化</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:init&quot;</span>);</span><br><span class="line">                <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">init</span>();<span class="comment">//初始化的函数</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:idle&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">pause</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:pause&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:die&quot;</span>);</span><br><span class="line">                <span class="title class_">MenuManager</span>.<span class="property">instance</span>.<span class="title function_">gameEnd</span>();<span class="comment">//执行游戏结束的函数</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error:Wrong game status!&quot;</span>)</span><br><span class="line">                <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_gameStatus</span>=status;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">gameStatus</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_gameStatus</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//更新、获取游戏分数</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">score</span>(<span class="params">score:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`Score:<span class="subst">$&#123;score&#125;</span>`</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_score</span>=score;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">score</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_score</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">init</span>(<span class="params"></span>)&#123;<span class="comment">//初始化</span></span><br><span class="line">        <span class="keyword">if</span>(director.<span class="title function_">isPaused</span>())&#123;<span class="comment">//判断场景状态(是否二次加载)</span></span><br><span class="line">            director.<span class="title function_">resume</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">allBricks</span>=[];<span class="comment">//清除数组</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">removeAllChildren</span>();<span class="comment">//移除所有子节点（障碍物）</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BackgroundPlace</span>.<span class="title function_">removeAllChildren</span>();<span class="comment">//移除所有子节点（背景）</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">score</span>=<span class="number">0</span>;<span class="comment">//分数归零</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">Timer</span>=<span class="number">0</span>;<span class="comment">//计时器归零</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">summonBricks</span>();<span class="comment">//生成第一个障碍物</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">summonFirstBackground</span>();<span class="comment">//生成第一个背景</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">summonBackground</span>();<span class="comment">//生成背景</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">scheduleOnce</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>;</span><br><span class="line">        &#125;,<span class="number">0.2</span>)<span class="comment">//延迟0.2s后切换状态</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonBricks</span>(<span class="params"></span>)&#123;<span class="comment">//生成砖块</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span> == <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>)&#123;<span class="comment">//死了就不会继续生成了</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> rand = math.<span class="title function_">randomRange</span>(-<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpawnRand</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpawnRand</span>);<span class="comment">//随机数</span></span><br><span class="line">        <span class="keyword">const</span> newBrick=<span class="title function_">instantiate</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">pref_Brick</span>);<span class="comment">//实例化</span></span><br><span class="line">        &#123;<span class="comment">//自定义部分</span></span><br><span class="line">            <span class="keyword">let</span> up = newBrick.<span class="title function_">getChildByName</span>(<span class="string">&quot;Up&quot;</span>)<span class="comment">//障碍物的上半部分</span></span><br><span class="line">            <span class="keyword">let</span> down = newBrick.<span class="title function_">getChildByName</span>(<span class="string">&quot;Down&quot;</span>)<span class="comment">//障碍物的下半部分</span></span><br><span class="line">            <span class="keyword">let</span> score = newBrick.<span class="title function_">getChildByName</span>(<span class="string">&quot;Score&quot;</span>)<span class="comment">//障碍物的得分检测碰撞箱</span></span><br><span class="line">            <span class="keyword">let</span> pos = <span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickHeight</span>/<span class="number">2</span>+<span class="number">2000</span>;</span><br><span class="line">            <span class="keyword">let</span> scale = <span class="number">30</span>*<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickWidth</span></span><br><span class="line">            up.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,pos,<span class="number">0</span>));</span><br><span class="line">            down.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,-pos,<span class="number">0</span>));</span><br><span class="line">            up.<span class="title function_">setScale</span>(<span class="title function_">v3</span>(scale,<span class="number">2000</span>,<span class="number">30</span>));</span><br><span class="line">            down.<span class="title function_">setScale</span>(<span class="title function_">v3</span>(scale,<span class="number">2000</span>,<span class="number">30</span>));</span><br><span class="line">            score.<span class="title function_">setScale</span>(<span class="title function_">v3</span>(<span class="number">1</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickHeight</span>,<span class="number">30</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">addChild</span>(newBrick);<span class="comment">//添加子节点</span></span><br><span class="line">        newBrick.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,rand,<span class="number">0</span>));<span class="comment">//设置节点的相对位置</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">allBricks</span>.<span class="title function_">push</span>(newBrick)<span class="comment">//入队尾</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">allBricks</span>.<span class="property">length</span>&gt;<span class="number">8</span>)&#123;<span class="comment">//判断队列长度</span></span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">allBricks</span>.<span class="title function_">shift</span>().<span class="title function_">destroy</span>()<span class="comment">//队首出队并销毁</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">tween</span>(newBrick)<span class="comment">//移动</span></span><br><span class="line">            .<span class="title function_">to</span>(<span class="number">10</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-(<span class="number">1500</span>+<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpeed</span>*<span class="number">100</span>),rand,<span class="number">0</span>)&#125;)</span><br><span class="line">            .<span class="title function_">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">checkTimer</span>(<span class="params"></span>)&#123;<span class="comment">//每一定间隔生成砖块</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">Timer</span>&lt;<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpawnTime</span>)&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">Timer</span>++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">Timer</span>=<span class="number">0</span>;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">summonBricks</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Summon&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonBackground</span>(<span class="params"></span>)&#123;<span class="comment">//生成背景</span></span><br><span class="line">        <span class="keyword">const</span> newBackground = <span class="title function_">instantiate</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">pref_Background</span>);</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BackgroundPlace</span>.<span class="title function_">addChild</span>(newBackground);</span><br><span class="line">        newBackground.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">        <span class="title function_">tween</span>(newBackground)</span><br><span class="line">            .<span class="title function_">to</span>(<span class="number">10</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-<span class="number">2160</span>,<span class="number">0</span>,<span class="number">0</span>)&#125;)</span><br><span class="line">            .<span class="title function_">call</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            newBackground.<span class="title function_">destroy</span>();<span class="comment">//使用回调函数清除</span></span><br><span class="line">        &#125;)</span><br><span class="line">            .<span class="title function_">start</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonFirstBackground</span>(<span class="params"></span>)&#123;<span class="comment">//生成第一个背景</span></span><br><span class="line">        <span class="keyword">const</span> newBackground = <span class="title function_">instantiate</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">pref_Background</span>);</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BackgroundPlace</span>.<span class="title function_">addChild</span>(newBackground);</span><br><span class="line">        newBackground.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(-<span class="number">1080</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">        <span class="title function_">tween</span>(newBackground)</span><br><span class="line">            .<span class="title function_">to</span>(<span class="number">10</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-<span class="number">3240</span>,<span class="number">0</span>,<span class="number">0</span>)&#125;)</span><br><span class="line">            .<span class="title function_">call</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            newBackground.<span class="title function_">destroy</span>();<span class="comment">//使用回调函数清除</span></span><br><span class="line">        &#125;)</span><br><span class="line">            .<span class="title function_">start</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span> = <span class="variable language_">this</span>;<span class="comment">//绑定单例</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">init</span>;<span class="comment">//初始化游戏</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">scheduler</span>:<span class="title class_">Scheduler</span> = director.<span class="title function_">getScheduler</span>();</span><br><span class="line">        scheduler.<span class="title function_">schedule</span>(<span class="variable language_">this</span>.<span class="property">summonBackground</span>,<span class="variable language_">this</span>,<span class="number">5</span>,macro.<span class="property">REPEAT_FOREVER</span>,<span class="number">0</span>,<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params">deltaTime: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">checkTimer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="障碍物-1"><a href="#障碍物-1" class="headerlink" title="障碍物"></a>障碍物</h4><p>简而言之就是给他换个贴图，这里需要先新建一个<strong>material材质</strong>，命名为brick，然后勾选USE ALBEDO MAP，把texture里的pipe_up拖进去，保存</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220820221219663.png" alt="创建材质"></p>
<p>然后再应用到障碍物预制件里的Up和Down，但是因为我们之前使用的是圆柱体，直接套用会有奇怪的问题，所以还是使用我之前提供的资源压缩包里的brick.prefab更佳，直接覆盖即可。</p>
<p>但是（又一个但是），因为我提供的障碍物的prefab是基于正方体修改来的，坐标会有少许变化，所以我们需要在GameManager里的summonBricks函数里调整一下自定义部分，也就是这两行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> pos = <span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickHeight</span>/<span class="number">2</span>+<span class="number">1000</span>;</span><br><span class="line"><span class="keyword">let</span> scale = <span class="number">40</span>*<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickWidth</span>;</span><br></pre></td></tr></table></figure>

<p>然后保存代码与场景，测试一下，你可能会觉得这障碍物的颜色不太对，这是因为场景里的光还是默认样式。在编辑器里把Main Light的Rotation角度设成(0,0,0)就好了（这里的光是全局平行光，与放置位置无关）</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220820223726317.png" alt="调整前"></p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220820223939129.png" alt="调整后"></p>
<h4 id="鸟儿"><a href="#鸟儿" class="headerlink" title="鸟儿"></a>鸟儿</h4><p>这一部分更简单，只需替换一下模型就好了。把fbx里的flappybird拖到场景里，替换一下原来的Bird就好了（记得把里面的BirdCtrl拖到新的flappyBird里），然后设置一下flappyBird的组件，碰撞箱的值可以微调一下</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220820235004862.png" alt="碰撞箱组件参数"></p>
<p>但是鸟儿只会水平飞看起来很不自然，所以这里一不做二不休，再给他加一个根据速度判断面向角度的函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">calculateAngle</span>(<span class="params"></span>)&#123;<span class="comment">//判断朝向角度</span></span><br><span class="line">    <span class="keyword">let</span> x = <span class="number">300</span>+<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpeed</span>*<span class="number">10</span>;<span class="comment">//x方向相对速度</span></span><br><span class="line">    <span class="keyword">let</span> v = <span class="title function_">v3</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="title function_">getLinearVelocity</span>(v);<span class="comment">//获取速度向量</span></span><br><span class="line">    <span class="keyword">let</span> y = v.<span class="property">y</span>;<span class="comment">//获取速度的y分量</span></span><br><span class="line">    <span class="keyword">let</span> angle = <span class="title class_">Math</span>.<span class="title function_">atan</span>(y/x);</span><br><span class="line">    <span class="keyword">let</span> num_angle = angle/<span class="number">3.141592</span>*<span class="number">180</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">setRTS</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">0</span>,num_angle))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在update函数里调用它，保存代码与场景并测试。大概你就能看到你的鸟儿像下面一样动起来了</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/gif-10.gif" alt="会动的鸟儿"></p>
<p>目前代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BirdCtrl.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">RigidBody</span>, v3, input, <span class="title class_">Input</span>, <span class="title class_">EventMouse</span>, <span class="title class_">PhysicsSystem</span>, <span class="title class_">ICollisionEvent</span>, <span class="title class_">SphereCollider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnumGameStatus</span>, <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameData</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameData&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;BirdCtrl&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BirdCtrl</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//鸟所在的节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Bird</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//刚体组件，提前加载并缓存以减轻游戏性能开销，提升优化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">RigidBodyComPonent</span>:<span class="title class_">RigidBody</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span> = <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">checkPos</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">changeDamping</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">calculateAngle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">200</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdPos</span>,<span class="number">0</span>))<span class="comment">//设置初始位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">setScale</span>(<span class="title function_">v3</span>(<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdScale</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdScale</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdScale</span>))<span class="comment">//设置体型大小</span></span><br><span class="line">        input.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">MOUSE_DOWN</span>,<span class="variable language_">this</span>.<span class="property">onMouseClick</span>,<span class="variable language_">this</span>);<span class="comment">//开启输入监听</span></span><br><span class="line">        <span class="title class_">PhysicsSystem</span>.<span class="property">instance</span>.<span class="property">gravity</span>=<span class="title function_">v3</span>(<span class="number">0</span>,-<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdGravity</span>,<span class="number">0</span>);<span class="comment">//设置重力</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="property">linearDamping</span>=<span class="number">0</span>;<span class="comment">//设置速度阻尼</span></span><br><span class="line">        <span class="comment">//this.Bird.getComponent(Collider).on(&#x27;onTriggerEnter&#x27;,this.onHit,this)//原来的开启碰撞检测</span></span><br><span class="line">        <span class="keyword">let</span> coms=<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponents</span>(<span class="title class_">SphereCollider</span>);<span class="comment">//两个球体碰撞箱组件</span></span><br><span class="line">        coms[<span class="number">0</span>].<span class="title function_">on</span>(<span class="string">&#x27;onCollisionEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">onHit</span>,<span class="variable language_">this</span>);<span class="comment">//第一个碰撞箱，不使用触发器，对障碍物进行判断</span></span><br><span class="line">        coms[<span class="number">1</span>].<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">getScore</span>,<span class="variable language_">this</span>)<span class="comment">//第二个碰撞箱，使用触发器，对分数进行判断</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onMouseClick</span>(<span class="params">event: EventMouse</span>)&#123;<span class="comment">//鼠标输入</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>).<span class="title function_">setLinearVelocity</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdJumpStrength</span>,<span class="number">0</span>));<span class="comment">//更改速度为向上</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onHit</span>(<span class="params">event: ICollisionEvent</span>)&#123;<span class="comment">//撞上柱子</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hit&quot;</span>);</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span> = <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;<span class="comment">//碰撞后死亡</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getScore</span>(<span class="params">event: ICollisionEvent</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Scored&quot;</span>);</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">score</span>+=<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickPoint</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">changeDamping</span>(<span class="params"></span>)&#123;<span class="comment">//切换速度阻尼，向上阻尼大，向下阻尼小</span></span><br><span class="line">        <span class="keyword">let</span> speed = <span class="title function_">v3</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="title function_">getLinearVelocity</span>(speed);</span><br><span class="line">        <span class="keyword">if</span>(speed.<span class="property">y</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="property">linearDamping</span> = <span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdSpeedUpDamping</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="property">linearDamping</span> = <span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdSpeedDownDamping</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">checkPos</span>(<span class="params"></span>)&#123;<span class="comment">//检查鸟儿位置，离开屏幕判定为死亡</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="property">position</span>.<span class="property">y</span>&lt;<span class="number">0</span>||<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="property">position</span>.<span class="property">y</span>&gt;<span class="number">1920</span>)&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span> = <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">calculateAngle</span>(<span class="params"></span>)&#123;<span class="comment">//判断朝向角度</span></span><br><span class="line">        <span class="keyword">let</span> x = <span class="number">300</span>+<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpeed</span>*<span class="number">10</span>;<span class="comment">//x方向相对速度</span></span><br><span class="line">        <span class="keyword">let</span> v = <span class="title function_">v3</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="title function_">getLinearVelocity</span>(v);<span class="comment">//获取速度向量</span></span><br><span class="line">        <span class="keyword">let</span> y = v.<span class="property">y</span>;<span class="comment">//获取速度的y分量</span></span><br><span class="line">        <span class="keyword">let</span> angle = <span class="title class_">Math</span>.<span class="title function_">atan</span>(y/x);</span><br><span class="line">        <span class="keyword">let</span> num_angle = angle/<span class="number">3.141592</span>*<span class="number">180</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">setRTS</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">0</span>,num_angle))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="计分板-1"><a href="#计分板-1" class="headerlink" title="计分板"></a>计分板</h4><p>原版游戏中的计分板采用了特殊字体，这里直接把lb_score里的Use System Font反选，然后将font里的number字体拖进去即可。注意，由于新的字体仅包含10个数字，所以lb_score的初始string需要修改，在GameManager里变更分数显示的部分需要更改，就像下面这样</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="title function_">score</span>(<span class="params">score:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">    <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`<span class="subst">$&#123;score&#125;</span>`</span></span><br><span class="line">    <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_score</span>=score;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821104444120.png" alt="应用字体"></p>
<p>除此之外，由于字体变大了，所以你还需要调整一下字体的大小</p>
<p>然后保存代码和场景并测试，你应该就能看到游戏用上新的字体了</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821110658300.png" alt="新的字体"></p>
<h4 id="界面"><a href="#界面" class="headerlink" title="界面"></a>界面</h4><p>这一部分只需要我们替换面板和按钮的材质即可，以结束界面为例，我们需要在texture文件夹里将需要使用的材质(book)的类型更改为sprite-frame，然后拖入endMenu的Sprite组件内即可(颜色可以改回纯白)</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821111927776.png" alt="精灵组件参数"></p>
<p>然后把结算的分数标签的字体改成之前提到的特殊字体(因此你需要去MenuManager里改一下文本)，最好再改个颜色</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">gameEnd</span>(<span class="params"></span>)&#123;<span class="comment">//游戏结束</span></span><br><span class="line">    director.<span class="title function_">pause</span>()<span class="comment">//游戏场景暂停</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">endMenu</span>.<span class="property">active</span> = <span class="literal">true</span>;<span class="comment">//激活节点</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`<span class="subst">$&#123;GameManager.instance._score&#125;</span>`</span><span class="comment">//修改文本</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821113148384.png" alt="结算面板分数标签"></p>
<p>按钮则需要你把对应的材质转成的sprite-frame拖入Button组件里的四个sprite内（分别对应普通、按下、悬浮、禁用，由于这里没有别的资源所以就用四个一样的），由于使用了材质，里面的文字标签就不适合出现了，这里需要删除</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821113418768.png" alt="按钮组件参数"></p>
<p>为了美观，还可以把Gameover的图片放进来，位置与大小自定</p>
<p>对于其他界面也是同样的做法，所以这里就省略过程，只给出大致的参考</p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821111139529.png" alt="结束界面参考"></p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821111242418.png" alt="游玩界面参考"></p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821111305450.png" alt="主界面参考"></p>
<p><img src="/images/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-2/image-20220821111325713.png" alt="设置页面参考"></p>
<h3 id="抛光打磨"><a href="#抛光打磨" class="headerlink" title="抛光打磨"></a>抛光打磨</h3><p>最后的最后，再优化一下代码，就差不多了</p>
<h4 id="GameManager"><a href="#GameManager" class="headerlink" title="GameManager"></a>GameManager</h4><ul>
<li>障碍物的优化方式更改为与背景相同的回调函数清理方式</li>
<li>障碍物的生成计时由帧计时改为计时器计时</li>
</ul>
<h4 id="BirdCtrl"><a href="#BirdCtrl" class="headerlink" title="BirdCtrl"></a>BirdCtrl</h4><ul>
<li>优化组件获取，减少冗余代码</li>
</ul>
<h4 id="MenuManager"><a href="#MenuManager" class="headerlink" title="MenuManager"></a>MenuManager</h4><ul>
<li>添加结束后游玩场景按钮隐藏功能</li>
</ul>
<h4 id="Setting"><a href="#Setting" class="headerlink" title="Setting"></a>Setting</h4><ul>
<li>修改砖块生成时间的默认数值</li>
</ul>
<h4 id="SettingManager"><a href="#SettingManager" class="headerlink" title="SettingManager"></a>SettingManager</h4><ul>
<li>修改滑动器默认位置</li>
<li>修改砖块生成时间的算法</li>
</ul>
<p>最终代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameSceneChange.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, director &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameSceneChange&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameSceneChange</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">changeScene</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//切换场景</span></span><br><span class="line">        director.<span class="title function_">loadScene</span>(<span class="title class_">CustomEventData</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Setting.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Setting</span> &#123;</span><br><span class="line">    <span class="comment">//鸟儿的初始高度</span></span><br><span class="line">    <span class="attr">birdPos</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//鸟儿的大小</span></span><br><span class="line">    <span class="attr">birdScale</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//下落加速度</span></span><br><span class="line">    <span class="attr">birdGravity</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//鸟儿向上的速度阻尼</span></span><br><span class="line">    <span class="attr">birdSpeedUpDamping</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//鸟儿向下的速度阻尼</span></span><br><span class="line">    <span class="attr">birdSpeedDownDamping</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//鸟儿跳跃力度</span></span><br><span class="line">    <span class="attr">birdJumpStrength</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//障碍物生成间隔时间</span></span><br><span class="line">    <span class="attr">brickSpawnTime</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//障碍物随机生成区间</span></span><br><span class="line">    <span class="attr">brickSpawnRand</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//障碍物移动速度</span></span><br><span class="line">    <span class="attr">brickSpeed</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//障碍物上下间距</span></span><br><span class="line">    <span class="attr">brickHeight</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//障碍物宽度</span></span><br><span class="line">    <span class="attr">brickWidth</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">//越过障碍物的得分</span></span><br><span class="line">    <span class="attr">brickPoint</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    birdPos:<span class="built_in">number</span>=<span class="number">960</span>,</span></span><br><span class="line"><span class="params">     birdScale:<span class="built_in">number</span>=<span class="number">50</span>,</span></span><br><span class="line"><span class="params">     birdGravity:<span class="built_in">number</span>=<span class="number">2000</span>,</span></span><br><span class="line"><span class="params">     birdSpeedUpDamping:<span class="built_in">number</span>=<span class="number">0.6</span>,</span></span><br><span class="line"><span class="params">     birdSpeedDownDamping:<span class="built_in">number</span>=<span class="number">0</span>,</span></span><br><span class="line"><span class="params">     birdJumpStrength:<span class="built_in">number</span>=<span class="number">800</span>,</span></span><br><span class="line"><span class="params">     brickSpawnTime:<span class="built_in">number</span>=<span class="number">5</span>,</span></span><br><span class="line"><span class="params">     brickSpawnRand:<span class="built_in">number</span>=<span class="number">500</span>,</span></span><br><span class="line"><span class="params">     brickSpeed:<span class="built_in">number</span>=<span class="number">10</span>,</span></span><br><span class="line"><span class="params">     brickHeight:<span class="built_in">number</span>=<span class="number">250</span>,</span></span><br><span class="line"><span class="params">     brickWidth:<span class="built_in">number</span>=<span class="number">5</span>,</span></span><br><span class="line"><span class="params">     brickPoint:<span class="built_in">number</span>=<span class="number">1</span>,</span></span><br><span class="line"><span class="params">    </span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">birdPos</span> = birdPos;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">birdScale</span> = birdScale;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">birdGravity</span> = birdGravity;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">birdSpeedUpDamping</span> = birdSpeedUpDamping;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">birdSpeedDownDamping</span> = birdSpeedDownDamping;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">birdJumpStrength</span> = birdJumpStrength;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">brickSpawnTime</span> = brickSpawnTime;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">brickSpawnRand</span> = brickSpawnRand;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">brickSpeed</span> = brickSpeed;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">brickHeight</span> = brickHeight;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">brickWidth</span> = brickWidth;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">brickPoint</span> = brickPoint;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SettingManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, sys, find, <span class="title class_">Slider</span>, <span class="title class_">Label</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Setting</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Setting&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">EnumSettingType</span>&#123;<span class="comment">//枚举设置类型，便于后续数组操作</span></span><br><span class="line">    birdPos=<span class="number">0</span>,</span><br><span class="line">    birdScale=<span class="number">1</span>,</span><br><span class="line">    birdGravity=<span class="number">2</span>,</span><br><span class="line">    birdSpeedUpDamping=<span class="number">3</span>,</span><br><span class="line">    birdSpeedDownDamping=<span class="number">4</span>,</span><br><span class="line">    birdJumpStrength=<span class="number">5</span>,</span><br><span class="line">    brickSpawnTime=<span class="number">6</span>,</span><br><span class="line">    brickSpawnRand=<span class="number">7</span>,</span><br><span class="line">    brickSpeed=<span class="number">8</span>,</span><br><span class="line">    brickHeight=<span class="number">9</span>,</span><br><span class="line">    brickWidth=<span class="number">10</span>,</span><br><span class="line">    brickPoint=<span class="number">11</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">EnumNodeType</span>&#123;<span class="comment">//枚举节点类型，便于后续数组操作</span></span><br><span class="line">    lb_description=<span class="number">0</span>,</span><br><span class="line">    slider=<span class="number">1</span>,</span><br><span class="line">    lb_value=<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;SettingManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">SettingManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//菜单节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Menu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//未保存提示的节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Warning</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//设置模板，带默认参数</span></span><br><span class="line">    <span class="keyword">private</span> localSetting = <span class="keyword">new</span> <span class="title class_">Setting</span>();</span><br><span class="line">    <span class="comment">//保存指示器</span></span><br><span class="line">    <span class="keyword">private</span> isSaved = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//菜单里的设置的根节点，用于后续查找</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nodeArray</span>:<span class="title class_">Node</span>[][];</span><br><span class="line">    <span class="comment">//设置选项的字符串表，用于查找顺序</span></span><br><span class="line">    <span class="keyword">private</span>  stringOfSetting = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="string">&quot;birdPos&quot;</span>,<span class="string">&quot;birdScale&quot;</span>,<span class="string">&quot;birdGravity&quot;</span>,<span class="string">&quot;birdSpeedUpDamping&quot;</span>,<span class="string">&quot;birdSpeedDownDamping&quot;</span>,<span class="string">&quot;birdJumpStrength&quot;</span>,<span class="string">&quot;brickSpawnTime&quot;</span>,<span class="string">&quot;brickSpawnRand&quot;</span>,<span class="string">&quot;brickSpeed&quot;</span>,<span class="string">&quot;brickHeight&quot;</span>,<span class="string">&quot;brickWidth&quot;</span>,<span class="string">&quot;brickPoint&quot;</span>)</span><br><span class="line">    <span class="comment">//滑条百分比的数据</span></span><br><span class="line">    <span class="keyword">private</span> sliderData = <span class="keyword">new</span> <span class="title class_">Setting</span>(<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.75</span>,<span class="number">0</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">clickApplyBtn</span>(<span class="params"></span>)&#123;<span class="comment">//点击应用按钮</span></span><br><span class="line">        sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;gameValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">localSetting</span>));<span class="comment">//储存本地设置至浏览器缓存</span></span><br><span class="line">        sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;sliderValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">sliderData</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isSaved</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickSettingBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//点击设置按钮</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getData</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Menu</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="variable language_">this</span>.<span class="property">nodeArray</span>.<span class="property">length</span>;i++)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">nodeArray</span>[i][<span class="title class_">EnumNodeType</span>.<span class="property">slider</span>].<span class="title function_">getComponent</span>(<span class="title class_">Slider</span>).<span class="property">progress</span> = <span class="variable language_">this</span>.<span class="property">sliderData</span>[<span class="variable language_">this</span>.<span class="property">stringOfSetting</span>[i]];</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">nodeArray</span>[i][<span class="title class_">EnumNodeType</span>.<span class="property">lb_value</span>].<span class="title function_">getComponent</span>(<span class="title class_">Label</span>).<span class="property">string</span> = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.localSetting[<span class="variable language_">this</span>.stringOfSetting[i]]&#125;</span>`</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickReturnBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//点击返回按钮</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">isSaved</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Menu</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Warning</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isSaved</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">Warning</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;     </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getData</span>(<span class="params"></span>)&#123;<span class="comment">//从浏览器获取缓存数据</span></span><br><span class="line">        <span class="keyword">if</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;gameValue&quot;</span>) === <span class="literal">null</span>||sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;sliderValue&quot;</span>) === <span class="literal">null</span>)&#123;<span class="comment">//传入默认设置</span></span><br><span class="line">            sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;gameValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">localSetting</span>))</span><br><span class="line">            sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;sliderValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">sliderData</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">localSetting</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;gameValue&quot;</span>))<span class="comment">//获取浏览器缓存设置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sliderData</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;sliderValue&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getNodeArray</span>(<span class="params"></span>)&#123;<span class="comment">//获取设置的所有节点，便于后续操作</span></span><br><span class="line">        <span class="keyword">let</span> rootNodeChildren = <span class="title function_">find</span>(<span class="string">&#x27;Canvas/Setting/Sliders&#x27;</span>).<span class="property">children</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nodeArray</span> = <span class="keyword">new</span> <span class="title class_">Array</span>(rootNodeChildren.<span class="property">length</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;rootNodeChildren.<span class="property">length</span>;i++)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">nodeArray</span>[i] = <span class="keyword">new</span> <span class="title class_">Array</span>(rootNodeChildren[<span class="number">0</span>].<span class="property">children</span>.<span class="property">length</span>)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">nodeArray</span>[i] = rootNodeChildren[i].<span class="property">children</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">changeSetting</span>(<span class="params">event:Event,CustomEventData</span>)&#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isSaved</span> = <span class="literal">false</span>;<span class="comment">//保存指示器置否，表示未保存状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Warning</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//关闭提示标签</span></span><br><span class="line">        <span class="title class_">CustomEventData</span> = <span class="built_in">parseInt</span>(<span class="title class_">CustomEventData</span>);<span class="comment">//传入是字符串，转成整数</span></span><br><span class="line">        <span class="keyword">let</span> value,progress;</span><br><span class="line">        progress = <span class="variable language_">this</span>.<span class="property">nodeArray</span>[<span class="title class_">CustomEventData</span>][<span class="title class_">EnumNodeType</span>.<span class="property">slider</span>].<span class="title function_">getComponent</span>(<span class="title class_">Slider</span>).<span class="property">progress</span>.<span class="title function_">toFixed</span>(<span class="number">2</span>);<span class="comment">//滑动器的百分比</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span>(<span class="title class_">CustomEventData</span>)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdPos</span>:</span><br><span class="line">                value = (<span class="number">1920</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdScale</span>:</span><br><span class="line">                value = (<span class="number">10</span>+<span class="number">80</span>*progress).<span class="title function_">toFixed</span>(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdGravity</span>:</span><br><span class="line">                value = (<span class="number">4000</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdSpeedUpDamping</span>:</span><br><span class="line">                value = (<span class="number">0.8</span>*progress).<span class="title function_">toFixed</span>(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdSpeedDownDamping</span>:</span><br><span class="line">                value = (<span class="number">0.8</span>*progress).<span class="title function_">toFixed</span>(<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">birdJumpStrength</span>:</span><br><span class="line">                value = (<span class="number">1600</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickSpawnTime</span>:</span><br><span class="line">                value = (<span class="number">10</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickSpawnRand</span>:</span><br><span class="line">                value = (<span class="number">1000</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickSpeed</span>:</span><br><span class="line">                value = (<span class="number">5</span>+<span class="number">10</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickHeight</span>:</span><br><span class="line">                value = (<span class="number">50</span>+<span class="number">400</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickWidth</span>:</span><br><span class="line">                value = (<span class="number">1</span>+<span class="number">8</span>*progress).<span class="title function_">toFixed</span>(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumSettingType</span>.<span class="property">brickPoint</span>:</span><br><span class="line">                value = (<span class="number">1</span>+<span class="number">2</span>*progress).<span class="title function_">toFixed</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">localSetting</span>[<span class="variable language_">this</span>.<span class="property">stringOfSetting</span>[<span class="title class_">CustomEventData</span>]] = value;<span class="comment">//修改本地设置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sliderData</span>[<span class="variable language_">this</span>.<span class="property">stringOfSetting</span>[<span class="title class_">CustomEventData</span>]] = progress;<span class="comment">//修改本地滑动器设置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nodeArray</span>[<span class="title class_">CustomEventData</span>][<span class="title class_">EnumNodeType</span>.<span class="property">lb_value</span>].<span class="title function_">getComponent</span>(<span class="title class_">Label</span>).<span class="property">string</span> = <span class="string">`<span class="subst">$&#123;value&#125;</span>`</span><span class="comment">//修改数字标签内容</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Menu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//设置菜单，初始关闭</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Warning</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//未保存提示，初始关闭</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getNodeArray</span>();<span class="comment">//获取节点数据</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameData.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, sys &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Setting</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./Setting&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property,executionOrder &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameData&#x27;</span>)</span><br><span class="line"><span class="meta">@executionOrder</span>(-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameData</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> data = <span class="keyword">new</span> <span class="title class_">Setting</span>();</span><br><span class="line">    <span class="title function_">getData</span>(<span class="params"></span>)&#123;<span class="comment">//获取数据</span></span><br><span class="line">        <span class="keyword">if</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;gameValue&quot;</span>) === <span class="literal">null</span>)&#123;</span><br><span class="line">            sys.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;gameValue&quot;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="title class_">GameData</span>.<span class="property">data</span>))<span class="comment">//如果没有数据，则传入默认设置</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameData</span>.<span class="property">data</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(sys.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;gameValue&quot;</span>))<span class="comment">//获取浏览器缓存设置</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> x <span class="keyword">in</span> <span class="title class_">GameData</span>.<span class="property">data</span>)&#123;<span class="comment">//把取得的数据转为整数</span></span><br><span class="line">            <span class="title class_">GameData</span>.<span class="property">data</span>[x] = <span class="built_in">parseFloat</span>(<span class="title class_">GameData</span>.<span class="property">data</span>[x]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getData</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MenuManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, director, <span class="title class_">Label</span>, <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;MenuManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">MenuManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//暂停菜单</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">pauseMenu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//结算菜单</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">endMenu</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计分板节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    <span class="attr">lb_score</span>:<span class="title class_">Label</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//暂停按钮</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">btn_pauseBtn</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//场景计分板</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="attr">lb_MainScore</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line">    <span class="comment">//MenuManager单例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="attr">instance</span>:<span class="title class_">MenuManager</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">MenuManager</span>.<span class="property">instance</span> = <span class="variable language_">this</span>;<span class="comment">//绑定单例</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏暂停菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">endMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏结算菜单</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">clickReplayBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//游戏重新开始</span></span><br><span class="line">        director.<span class="title function_">resume</span>()<span class="comment">//游戏场景恢复</span></span><br><span class="line">        director.<span class="title function_">loadScene</span>(<span class="title class_">CustomEventData</span>);<span class="comment">//重新载入场景</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickPauseBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//暂停游戏</span></span><br><span class="line">        director.<span class="title function_">pause</span>()<span class="comment">//游戏场景暂停</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickResumeBtn</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//恢复游戏</span></span><br><span class="line">        director.<span class="title function_">resume</span>()<span class="comment">//游戏场景恢复</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pauseMenu</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//关闭菜单</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">changeScene</span>(<span class="params">event:Event,CustomEventData</span>)&#123;<span class="comment">//切换场景</span></span><br><span class="line">        director.<span class="title function_">loadScene</span>(<span class="title class_">CustomEventData</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">gameEnd</span>(<span class="params"></span>)&#123;<span class="comment">//游戏结束</span></span><br><span class="line">        director.<span class="title function_">pause</span>()<span class="comment">//游戏场景暂停</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">endMenu</span>.<span class="property">active</span> = <span class="literal">true</span>;<span class="comment">//激活节点</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`<span class="subst">$&#123;GameManager.instance._score&#125;</span>`</span><span class="comment">//修改文本</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lb_MainScore</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏计分板</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">btn_pauseBtn</span>.<span class="property">active</span> = <span class="literal">false</span>;<span class="comment">//隐藏暂停按钮</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GameManager.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">Prefab</span>, math, v3, instantiate, tween, <span class="title class_">Label</span>, director, macro, <span class="title class_">Scheduler</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameData</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameData&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MenuManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./MenuManager&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> <span class="title class_">EnumGameStatus</span>&#123;<span class="comment">//游戏状态</span></span><br><span class="line">    init=<span class="number">1</span>,<span class="comment">//初始化</span></span><br><span class="line">    idle=<span class="number">2</span>,<span class="comment">//游玩</span></span><br><span class="line">    pause=<span class="number">3</span>,<span class="comment">//暂停</span></span><br><span class="line">    die=<span class="number">4</span>,<span class="comment">//死亡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;GameManager&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">GameManager</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//障碍物</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">pref_Brick</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//背景</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Prefab</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">pref_Background</span>:<span class="title class_">Prefab</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//障碍物生成节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nd_BrickPlace</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//背景生成节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nd_BackgroundPlace</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//计分板节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Label</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">lb_score</span>:<span class="title class_">Label</span> = <span class="literal">null</span>!</span><br><span class="line"></span><br><span class="line">    <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//GameManager单例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="attr">instance</span>:<span class="title class_">GameManager</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//游戏状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_gameStatus</span>:<span class="title class_">EnumGameStatus</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//分数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">_score</span>:<span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">//更新、获取游戏状态</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">gameStatus</span>(<span class="params">status:EnumGameStatus</span>)&#123;</span><br><span class="line">        <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">init</span>:<span class="comment">//初始化</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:init&quot;</span>);</span><br><span class="line">                <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">init</span>();<span class="comment">//初始化的函数</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:idle&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">pause</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:pause&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Status:die&quot;</span>);</span><br><span class="line">                <span class="title class_">MenuManager</span>.<span class="property">instance</span>.<span class="title function_">gameEnd</span>();<span class="comment">//执行游戏结束的函数</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Error:Wrong game status!&quot;</span>)</span><br><span class="line">                <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_gameStatus</span>=status;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">gameStatus</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_gameStatus</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//更新、获取游戏分数</span></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">score</span>(<span class="params">score:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">lb_score</span>.<span class="property">string</span> = <span class="string">`<span class="subst">$&#123;score&#125;</span>`</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_score</span>=score;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">score</span>()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">_score</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">init</span>(<span class="params"></span>)&#123;<span class="comment">//初始化</span></span><br><span class="line">        <span class="keyword">if</span>(director.<span class="title function_">isPaused</span>())&#123;<span class="comment">//判断场景状态(是否二次加载)</span></span><br><span class="line">            director.<span class="title function_">resume</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">removeAllChildren</span>();<span class="comment">//移除所有子节点（障碍物）</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BackgroundPlace</span>.<span class="title function_">removeAllChildren</span>();<span class="comment">//移除所有子节点（背景）</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">score</span>=<span class="number">0</span>;<span class="comment">//分数归零</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">summonBricks</span>();<span class="comment">//生成第一个障碍物</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">summonFirstBackground</span>();<span class="comment">//生成第一个背景</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">summonBackground</span>();<span class="comment">//生成背景</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="title function_">scheduleOnce</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">idle</span>;</span><br><span class="line">        &#125;,<span class="number">0.2</span>)<span class="comment">//延迟0.2s后切换状态</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonBricks</span>(<span class="params"></span>)&#123;<span class="comment">//生成砖块</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span> == <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>)&#123;<span class="comment">//死了就不会继续生成了</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> rand = math.<span class="title function_">randomRange</span>(-<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpawnRand</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpawnRand</span>);<span class="comment">//随机数</span></span><br><span class="line">        <span class="keyword">const</span> newBrick=<span class="title function_">instantiate</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">pref_Brick</span>);<span class="comment">//实例化</span></span><br><span class="line">        &#123;<span class="comment">//自定义部分</span></span><br><span class="line">            <span class="keyword">let</span> up = newBrick.<span class="title function_">getChildByName</span>(<span class="string">&quot;Up&quot;</span>)<span class="comment">//障碍物的上半部分</span></span><br><span class="line">            <span class="keyword">let</span> down = newBrick.<span class="title function_">getChildByName</span>(<span class="string">&quot;Down&quot;</span>)<span class="comment">//障碍物的下半部分</span></span><br><span class="line">            <span class="keyword">let</span> score = newBrick.<span class="title function_">getChildByName</span>(<span class="string">&quot;Score&quot;</span>)<span class="comment">//障碍物的得分检测碰撞箱</span></span><br><span class="line">            <span class="keyword">let</span> pos = <span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickHeight</span>/<span class="number">2</span>+<span class="number">1000</span>;</span><br><span class="line">            <span class="keyword">let</span> scale = <span class="number">40</span>*<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickWidth</span>;</span><br><span class="line">            up.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,pos,<span class="number">0</span>));</span><br><span class="line">            down.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,-pos,<span class="number">0</span>));</span><br><span class="line">            up.<span class="title function_">setScale</span>(<span class="title function_">v3</span>(scale,<span class="number">2000</span>,<span class="number">30</span>));</span><br><span class="line">            down.<span class="title function_">setScale</span>(<span class="title function_">v3</span>(scale,<span class="number">2000</span>,<span class="number">30</span>));</span><br><span class="line">            score.<span class="title function_">setScale</span>(<span class="title function_">v3</span>(<span class="number">1</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickHeight</span>,<span class="number">30</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BrickPlace</span>.<span class="title function_">addChild</span>(newBrick);<span class="comment">//添加子节点</span></span><br><span class="line">        newBrick.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,rand,<span class="number">0</span>));<span class="comment">//设置节点的相对位置</span></span><br><span class="line"></span><br><span class="line">        <span class="title function_">tween</span>(newBrick)<span class="comment">//移动</span></span><br><span class="line">            .<span class="title function_">to</span>(<span class="number">10</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-(<span class="number">1500</span>+<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpeed</span>*<span class="number">100</span>),rand,<span class="number">0</span>)&#125;)</span><br><span class="line">            .<span class="title function_">call</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            newBrick.<span class="title function_">destroy</span>();<span class="comment">//使用回调函数清除</span></span><br><span class="line">        &#125;)</span><br><span class="line">            .<span class="title function_">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonBackground</span>(<span class="params"></span>)&#123;<span class="comment">//生成背景</span></span><br><span class="line">        <span class="keyword">const</span> newBackground = <span class="title function_">instantiate</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">pref_Background</span>);</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BackgroundPlace</span>.<span class="title function_">addChild</span>(newBackground);</span><br><span class="line">        newBackground.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">        <span class="title function_">tween</span>(newBackground)</span><br><span class="line">            .<span class="title function_">to</span>(<span class="number">10</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-<span class="number">2160</span>,<span class="number">0</span>,<span class="number">0</span>)&#125;)</span><br><span class="line">            .<span class="title function_">call</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            newBackground.<span class="title function_">destroy</span>();<span class="comment">//使用回调函数清除</span></span><br><span class="line">        &#125;)</span><br><span class="line">            .<span class="title function_">start</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">summonFirstBackground</span>(<span class="params"></span>)&#123;<span class="comment">//生成第一个背景</span></span><br><span class="line">        <span class="keyword">const</span> newBackground = <span class="title function_">instantiate</span>(<span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">pref_Background</span>);</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">nd_BackgroundPlace</span>.<span class="title function_">addChild</span>(newBackground);</span><br><span class="line">        newBackground.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(-<span class="number">1080</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">        <span class="title function_">tween</span>(newBackground)</span><br><span class="line">            .<span class="title function_">to</span>(<span class="number">10</span>,&#123;<span class="attr">position</span>:<span class="title function_">v3</span>(-<span class="number">3240</span>,<span class="number">0</span>,<span class="number">0</span>)&#125;)</span><br><span class="line">            .<span class="title function_">call</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            newBackground.<span class="title function_">destroy</span>();<span class="comment">//使用回调函数清除</span></span><br><span class="line">        &#125;)</span><br><span class="line">            .<span class="title function_">start</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span> = <span class="variable language_">this</span>;<span class="comment">//绑定单例</span></span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span>=<span class="title class_">EnumGameStatus</span>.<span class="property">init</span>;<span class="comment">//初始化游戏</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">scheduler</span>:<span class="title class_">Scheduler</span> = director.<span class="title function_">getScheduler</span>();</span><br><span class="line">        scheduler.<span class="title function_">schedule</span>(<span class="variable language_">this</span>.<span class="property">summonBackground</span>,<span class="variable language_">this</span>,<span class="number">5</span>,macro.<span class="property">REPEAT_FOREVER</span>,<span class="number">0</span>,<span class="literal">false</span>);<span class="comment">//周期性生成背景</span></span><br><span class="line">        scheduler.<span class="title function_">schedule</span>(<span class="variable language_">this</span>.<span class="property">summonBricks</span>,<span class="variable language_">this</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpawnTime</span>,macro.<span class="property">REPEAT_FOREVER</span>,<span class="number">0</span>,<span class="literal">false</span>);<span class="comment">//周期性生成砖块</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BirdCtrl.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; _decorator, <span class="title class_">Component</span>, <span class="title class_">Node</span>, <span class="title class_">RigidBody</span>, v3, input, <span class="title class_">Input</span>, <span class="title class_">EventMouse</span>, <span class="title class_">PhysicsSystem</span>, <span class="title class_">ICollisionEvent</span>, <span class="title class_">SphereCollider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;cc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EnumGameStatus</span>, <span class="title class_">GameManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameManager&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GameData</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./GameData&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; ccclass, property &#125; = _decorator;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ccclass</span>(<span class="string">&#x27;BirdCtrl&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BirdCtrl</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//鸟所在的节点</span></span><br><span class="line">    <span class="meta">@property</span>(<span class="title class_">Node</span>)</span><br><span class="line">    <span class="title class_">Bird</span>:<span class="title class_">Node</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">//刚体组件，提前加载并缓存以减轻游戏性能开销</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">RigidBodyComPonent</span>:<span class="title class_">RigidBody</span> = <span class="literal">null</span>!</span><br><span class="line">    <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span> = <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponent</span>(<span class="title class_">RigidBody</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">checkPos</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">changeDamping</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">calculateAngle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">    <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">setPosition</span>(<span class="title function_">v3</span>(<span class="number">200</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdPos</span>,<span class="number">0</span>))<span class="comment">//设置初始位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">setScale</span>(<span class="title function_">v3</span>(<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdScale</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdScale</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdScale</span>))<span class="comment">//设置体型大小</span></span><br><span class="line">        input.<span class="title function_">on</span>(<span class="title class_">Input</span>.<span class="property">EventType</span>.<span class="property">MOUSE_DOWN</span>,<span class="variable language_">this</span>.<span class="property">onMouseClick</span>,<span class="variable language_">this</span>);<span class="comment">//开启输入监听</span></span><br><span class="line">        <span class="title class_">PhysicsSystem</span>.<span class="property">instance</span>.<span class="property">gravity</span>=<span class="title function_">v3</span>(<span class="number">0</span>,-<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdGravity</span>,<span class="number">0</span>);<span class="comment">//设置重力</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="property">linearDamping</span>=<span class="number">0</span>;<span class="comment">//设置速度阻尼</span></span><br><span class="line">        <span class="comment">//this.Bird.getComponent(Collider).on(&#x27;onTriggerEnter&#x27;,this.onHit,this)//原来的开启碰撞检测</span></span><br><span class="line">        <span class="keyword">let</span> coms=<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">getComponents</span>(<span class="title class_">SphereCollider</span>);<span class="comment">//两个球体碰撞箱组件</span></span><br><span class="line">        coms[<span class="number">0</span>].<span class="title function_">on</span>(<span class="string">&#x27;onCollisionEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">onHit</span>,<span class="variable language_">this</span>);<span class="comment">//第一个碰撞箱，不使用触发器，对障碍物进行判断</span></span><br><span class="line">        coms[<span class="number">1</span>].<span class="title function_">on</span>(<span class="string">&#x27;onTriggerEnter&#x27;</span>,<span class="variable language_">this</span>.<span class="property">getScore</span>,<span class="variable language_">this</span>)<span class="comment">//第二个碰撞箱，使用触发器，对分数进行判断</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onMouseClick</span>(<span class="params">event: EventMouse</span>)&#123;<span class="comment">//鼠标输入</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="title function_">setLinearVelocity</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdJumpStrength</span>,<span class="number">0</span>));<span class="comment">//更改速度为向上</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onHit</span>(<span class="params">event: ICollisionEvent</span>)&#123;<span class="comment">//撞上柱子</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hit&quot;</span>);</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span> = <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;<span class="comment">//碰撞后死亡</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getScore</span>(<span class="params">event: ICollisionEvent</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Scored&quot;</span>);</span><br><span class="line">        <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">score</span>+=<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickPoint</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">changeDamping</span>(<span class="params"></span>)&#123;<span class="comment">//切换速度阻尼，向上阻尼大，向下阻尼小</span></span><br><span class="line">        <span class="keyword">let</span> speed = <span class="title function_">v3</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="title function_">getLinearVelocity</span>(speed);</span><br><span class="line">        <span class="keyword">if</span>(speed.<span class="property">y</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="property">linearDamping</span> = <span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdSpeedUpDamping</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="property">linearDamping</span> = <span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">birdSpeedDownDamping</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">checkPos</span>(<span class="params"></span>)&#123;<span class="comment">//检查鸟儿位置，离开屏幕判定为死亡</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="property">position</span>.<span class="property">y</span>&lt;<span class="number">0</span>||<span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="property">position</span>.<span class="property">y</span>&gt;<span class="number">1920</span>)&#123;</span><br><span class="line">            <span class="title class_">GameManager</span>.<span class="property">instance</span>.<span class="property">gameStatus</span> = <span class="title class_">EnumGameStatus</span>.<span class="property">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">calculateAngle</span>(<span class="params"></span>)&#123;<span class="comment">//判断朝向角度</span></span><br><span class="line">        <span class="keyword">let</span> x = <span class="number">300</span>+<span class="title class_">GameData</span>.<span class="property">data</span>.<span class="property">brickSpeed</span>*<span class="number">10</span>;<span class="comment">//x方向相对速度</span></span><br><span class="line">        <span class="keyword">let</span> v = <span class="title function_">v3</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">RigidBodyComPonent</span>.<span class="title function_">getLinearVelocity</span>(v);<span class="comment">//获取速度向量</span></span><br><span class="line">        <span class="keyword">let</span> y = v.<span class="property">y</span>;<span class="comment">//获取速度的y分量</span></span><br><span class="line">        <span class="keyword">let</span> angle = <span class="title class_">Math</span>.<span class="title function_">atan</span>(y/x);</span><br><span class="line">        <span class="keyword">let</span> num_angle = angle/<span class="number">3.141592</span>*<span class="number">180</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">Bird</span>.<span class="title function_">setRTS</span>(<span class="title function_">v3</span>(<span class="number">0</span>,<span class="number">0</span>,num_angle))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="还可以做的事情"><a href="#还可以做的事情" class="headerlink" title="还可以做的事情"></a>还可以做的事情</h3><ul>
<li>随机事件<ul>
<li>无敌</li>
<li>障碍物加减速</li>
<li>鸟儿加减速</li>
<li>得分增加</li>
<li>…</li>
</ul>
</li>
<li>障碍物上下摆动</li>
<li>背景切换（白天&amp;黑夜）</li>
<li>设置的导出与还原</li>
<li>粒子效果</li>
<li>点击音效与背景音乐</li>
<li>鸟儿皮肤变更</li>
<li>…</li>
</ul>
<hr>
<center>全文到此结束，感谢你的阅读！</center>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Cocos/" rel="tag"># Cocos</a>
              <a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/" rel="tag"># 游戏开发</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/07/13/%E9%AB%98%E6%95%B0%E7%AC%94%E8%AE%B0/" rel="prev" title="高数笔记">
                  <i class="fa fa-chevron-left"></i> 高数笔记
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/08/22/Git%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/" rel="next" title="Git使用笔记">
                  Git使用笔记 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fire Egg</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">235k</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
